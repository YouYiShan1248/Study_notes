# 1. ES6ä¸­æ•°ç»„æ–°å¢äº†å“ªäº›æ‰©å±•ï¼Ÿ

![img](https://static.vue-js.com/a156b8d0-53c5-11eb-85f6-6fac77c0c9b3.png)



## Rest å‚æ•°ä¸ Spread è¯­æ³•

åœ¨ JavaScript ä¸­ï¼Œå¾ˆå¤šå†…å»ºå‡½æ•°éƒ½æ”¯æŒä¼ å…¥ä»»æ„æ•°é‡çš„å‚æ•°ã€‚

ä¾‹å¦‚ï¼š

- `Math.max(arg1, arg2, ..., argN)` â€”â€” è¿”å›å‚æ•°ä¸­çš„æœ€å¤§å€¼ã€‚
- `Object.assign(dest, src1, ..., srcN)` â€”â€” ä¾æ¬¡å°†å±æ€§ä» `src1..N` å¤åˆ¶åˆ° `dest`ã€‚
- â€¦â€¦ç­‰ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ç¼–å†™æ”¯æŒä¼ å…¥ä»»æ„æ•°é‡å‚æ•°çš„å‡½æ•°ï¼Œä»¥åŠå¦‚ä½•å°†æ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ç±»å‡½æ•°ã€‚

### Rest å‚æ•° `...`

åœ¨ JavaScript ä¸­ï¼Œæ— è®ºå‡½æ•°æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œä½ éƒ½å¯ä»¥åœ¨è°ƒç”¨å®ƒæ—¶ä¼ å…¥ä»»æ„æ•°é‡çš„å‚æ•°ã€‚

ä¾‹å¦‚ï¼š

```javascript
function sum(a, b) {
  return a + b;
}

alert( sum(1, 2, 3, 4, 5) );
```

è™½ç„¶è¿™é‡Œè¿™ä¸ªå‡½æ•°ä¸ä¼šå› ä¸ºä¼ å…¥è¿‡å¤šçš„å‚æ•°è€ŒæŠ¥é”™ã€‚ä½†æ˜¯ï¼Œå½“ç„¶ï¼Œåªæœ‰å‰ä¸¤ä¸ªå‚æ•°è¢«æ±‚å’Œäº†ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å®šä¹‰ä¸­å£°æ˜ä¸€ä¸ªæ•°ç»„æ¥æ”¶é›†å‚æ•°ã€‚è¯­æ³•æ˜¯è¿™æ ·çš„ï¼š`...å˜é‡å`ï¼Œè¿™å°†ä¼šå£°æ˜ä¸€ä¸ªæ•°ç»„å¹¶æŒ‡å®šå…¶åç§°ï¼Œå…¶ä¸­å­˜æœ‰å‰©ä½™çš„å‚æ•°ã€‚è¿™ä¸‰ä¸ªç‚¹çš„è¯­ä¹‰å°±æ˜¯â€œæ”¶é›†å‰©ä½™çš„å‚æ•°å¹¶å­˜è¿›æŒ‡å®šæ•°ç»„ä¸­â€ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰çš„å‚æ•°éƒ½æ”¾åˆ°æ•°ç»„ `args` ä¸­ï¼š

```javascript
function sumAll(...args) { // æ•°ç»„åä¸º args
  let sum = 0;

  for (let arg of args) sum += arg;

  return sum;
}

alert( sumAll(1) ); // 1
alert( sumAll(1, 2) ); // 3
alert( sumAll(1, 2, 3) ); // 6
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å°†ç¬¬ä¸€ä¸ªå‚æ•°è·å–ä¸ºå˜é‡ï¼Œå¹¶å°†å‰©ä½™çš„å‚æ•°æ”¶é›†èµ·æ¥ã€‚

ä¸‹é¢çš„ä¾‹å­æŠŠå‰ä¸¤ä¸ªå‚æ•°è·å–ä¸ºå˜é‡ï¼Œå¹¶æŠŠå‰©ä½™çš„å‚æ•°æ”¶é›†åˆ° `titles` æ•°ç»„ä¸­ï¼š

```javascript
function showName(firstName, lastName, ...titles) {
  alert( firstName + ' ' + lastName ); // Julius Caesar

  // å‰©ä½™çš„å‚æ•°è¢«æ”¾å…¥ titles æ•°ç»„ä¸­
  // i.e. titles = ["Consul", "Imperator"]
  alert( titles[0] ); // Consul
  alert( titles[1] ); // Imperator
  alert( titles.length ); // 2
}

showName("Julius", "Caesar", "Consul", "Imperator");
```

**Rest å‚æ•°å¿…é¡»æ”¾åˆ°å‚æ•°åˆ—è¡¨çš„æœ«å°¾**

Rest å‚æ•°ä¼šæ”¶é›†å‰©ä½™çš„æ‰€æœ‰å‚æ•°ï¼Œå› æ­¤ä¸‹é¢è¿™ç§ç”¨æ³•æ²¡æœ‰æ„ä¹‰ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´é”™è¯¯ï¼š

```javascript
function f(arg1, ...rest, arg2) { // arg2 åœ¨ ...rest åé¢ï¼Ÿï¼
  // error
}
```

`...rest` å¿…é¡»å†™åœ¨å‚æ•°åˆ—è¡¨æœ€åã€‚

### â€œargumentsâ€ å˜é‡

æœ‰ä¸€ä¸ªåä¸º `arguments` çš„ç‰¹æ®Šç±»æ•°ç»„å¯¹è±¡å¯ä»¥åœ¨å‡½æ•°ä¸­è¢«è®¿é—®ï¼Œè¯¥å¯¹è±¡ä»¥å‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ç´¢å¼•ä½œä¸ºé”®ï¼Œå­˜å‚¨æ‰€æœ‰å‚æ•°ã€‚

ä¾‹å¦‚ï¼š

```javascript
function showName() {
  alert( arguments.length );
  alert( arguments[0] );
  alert( arguments[1] );

  // å®ƒæ˜¯å¯éå†çš„
  // for(let arg of arguments) alert(arg);
}

// ä¾æ¬¡æ˜¾ç¤ºï¼š2ï¼ŒJuliusï¼ŒCaesar
showName("Julius", "Caesar");

// ä¾æ¬¡æ˜¾ç¤ºï¼š1ï¼ŒIlyaï¼Œundefinedï¼ˆæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼‰
showName("Ilya");
```

åœ¨è¿‡å»ï¼ŒJavaScript ä¸­ä¸æ”¯æŒ rest å‚æ•°è¯­æ³•ï¼Œè€Œä½¿ç”¨ `arguments` æ˜¯è·å–å‡½æ•°æ‰€æœ‰å‚æ•°çš„å”¯ä¸€æ–¹æ³•ã€‚ç°åœ¨å®ƒä»ç„¶æœ‰æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€äº›è€ä»£ç é‡Œæ‰¾åˆ°å®ƒã€‚

ä½†ç¼ºç‚¹æ˜¯ï¼Œå°½ç®¡ `arguments` æ˜¯ä¸€ä¸ªç±»æ•°ç»„ï¼Œä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œä½†å®ƒç»ˆç©¶ä¸æ˜¯æ•°ç»„ã€‚å®ƒä¸æ”¯æŒæ•°ç»„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½è°ƒç”¨ `arguments.map(...)` ç­‰æ–¹æ³•ã€‚

æ­¤å¤–ï¼Œå®ƒå§‹ç»ˆåŒ…å«æ‰€æœ‰å‚æ•°ï¼Œæˆ‘ä»¬ä¸èƒ½åƒä½¿ç”¨ rest å‚æ•°é‚£æ ·åªæˆªå–å‚æ•°çš„ä¸€éƒ¨åˆ†ã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦è¿™äº›åŠŸèƒ½æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ rest å‚æ•°ã€‚

**ç®­å¤´å‡½æ•°æ²¡æœ‰ `"arguments"`**

å¦‚æœæˆ‘ä»¬åœ¨ç®­å¤´å‡½æ•°ä¸­è®¿é—® `arguments`ï¼Œè®¿é—®åˆ°çš„ `arguments` å¹¶ä¸å±äºç®­å¤´å‡½æ•°ï¼Œè€Œæ˜¯å±äºç®­å¤´å‡½æ•°å¤–éƒ¨çš„â€œæ™®é€šâ€å‡½æ•°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```javascript
function f() {
  let showArg = () => alert(arguments[0]);
  showArg();
}

f(1); // 1
```

æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªèº«çš„ `this`ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å®ƒä»¬ä¹Ÿæ²¡æœ‰ç‰¹æ®Šçš„ `arguments` å¯¹è±¡ã€‚

### Spread è¯­æ³•

æˆ‘ä»¬åˆšåˆšçœ‹åˆ°äº†å¦‚ä½•ä»å‚æ•°åˆ—è¡¨ä¸­è·å–æ•°ç»„ã€‚

æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦åšä¸ä¹‹ç›¸åçš„äº‹ã€‚

ä¾‹å¦‚ï¼Œå†…å»ºå‡½æ•° [Math.max](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Math/max) ä¼šè¿”å›å‚æ•°ä¸­æœ€å¤§çš„å€¼ï¼š

```javascript
alert( Math.max(3, 5, 1) ); // 5
```

å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„ `[3, 5, 1]`ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ç”¨å®ƒè°ƒç”¨ `Math.max` å‘¢ï¼Ÿ

ç›´æ¥â€œåŸæ ·â€ä¼ å…¥è¿™ä¸ªæ•°ç»„æ˜¯ä¸ä¼šå¥æ•ˆçš„ï¼Œå› ä¸º `Math.max` æœŸæœ›çš„æ˜¯åˆ—è¡¨å½¢å¼çš„æ•°å€¼å‹å‚æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼š

```javascript
let arr = [3, 5, 1];

alert( Math.max(arr) ); // NaN
```

æ¯«æ— ç–‘é—®ï¼Œæˆ‘ä»¬ä¸èƒ½æ‰‹åŠ¨åœ°å»ä¸€ä¸€è®¾ç½®å‚æ•° `Math.max(arg[0], arg[1], arg[2])`ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šè¿™å„¿æœ‰å¤šå°‘ä¸ªã€‚åœ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œå‚æ•°æ•°ç»„ä¸­å¯èƒ½æœ‰å¾ˆå¤šä¸ªå…ƒç´ ï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªéƒ½æ²¡æœ‰ã€‚è€Œä¸”ï¼Œè¿™æ ·çš„ä»£ç ä¹Ÿå¾ˆä¸ä¼˜é›…ã€‚

**Spread è¯­æ³•** å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼å®ƒçœ‹èµ·æ¥å’Œ rest å‚æ•°å¾ˆåƒï¼Œä¹Ÿä½¿ç”¨ `...`ï¼Œä½†æ˜¯äºŒè€…çš„ç”¨é€”å®Œå…¨ç›¸åã€‚

å½“åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨ `...arr` æ—¶ï¼Œå®ƒä¼šæŠŠå¯è¿­ä»£å¯¹è±¡ `arr` â€œå±•å¼€â€åˆ°å‚æ•°åˆ—è¡¨ä¸­ã€‚

ä»¥ `Math.max` ä¸ºä¾‹ï¼š

```javascript
let arr = [3, 5, 1];

alert( Math.max(...arr) ); // 5ï¼ˆspread è¯­æ³•æŠŠæ•°ç»„è½¬æ¢ä¸ºå‚æ•°åˆ—è¡¨ï¼‰
```

æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ä¼ å…¥å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼š

```javascript
let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(...arr1, ...arr2) ); // 8
```

æˆ‘ä»¬ç”šè‡³è¿˜å¯ä»¥å°† spread è¯­æ³•ä¸å¸¸è§„å€¼ç»“åˆä½¿ç”¨ï¼š

```javascript
let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(1, ...arr1, 2, ...arr2, 25) ); // 25
```

å¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ spread è¯­æ³•æ¥åˆå¹¶æ•°ç»„ï¼š

```javascript
let arr = [3, 5, 1];
let arr2 = [8, 9, 15];

let merged = [0, ...arr, 2, ...arr2];

alert(merged); // 0,3,5,1,2,8,9,15ï¼ˆ0ï¼Œç„¶åæ˜¯ arrï¼Œç„¶åæ˜¯ 2ï¼Œç„¶åæ˜¯ arr2ï¼‰
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„å±•ç¤ºäº† spread è¯­æ³•ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç”¨ spread è¯­æ³•è¿™æ ·æ“ä½œä»»ä½•å¯è¿­ä»£å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œåœ¨è¿™å„¿æˆ‘ä»¬ä½¿ç”¨ spread è¯­æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ï¼š

```javascript
let str = "Hello";

alert( [...str] ); // H,e,l,l,o
```

Spread è¯­æ³•å†…éƒ¨ä½¿ç”¨äº†è¿­ä»£å™¨æ¥æ”¶é›†å…ƒç´ ï¼Œä¸ `for..of` çš„æ–¹å¼ç›¸åŒã€‚

å› æ­¤ï¼Œå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ`for..of` ä¼šé€ä¸ªè¿”å›è¯¥å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œ`...str` ä¹ŸåŒç†ä¼šå¾—åˆ° `"H","e","l","l","o"` è¿™æ ·çš„ç»“æœã€‚éšåï¼Œå­—ç¬¦åˆ—è¡¨è¢«ä¼ é€’ç»™æ•°ç»„åˆå§‹åŒ–å™¨ `[...str]`ã€‚

å¯¹äºè¿™ä¸ªç‰¹å®šä»»åŠ¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ `Array.from` æ¥å®ç°ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä¼šå°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚å­—ç¬¦ä¸²ï¼‰è½¬æ¢ä¸ºæ•°ç»„ï¼š

```javascript
let str = "Hello";

// Array.from å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„
alert( Array.from(str) ); // H,e,l,l,o
```

è¿è¡Œç»“æœä¸ `[...str]` ç›¸åŒã€‚

ä¸è¿‡ `Array.from(obj)` å’Œ `[...obj]` å­˜åœ¨ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ï¼š

- `Array.from` é€‚ç”¨äºç±»æ•°ç»„å¯¹è±¡ä¹Ÿé€‚ç”¨äºå¯è¿­ä»£å¯¹è±¡ã€‚
- Spread è¯­æ³•åªé€‚ç”¨äºå¯è¿­ä»£å¯¹è±¡ã€‚

å› æ­¤ï¼Œå¯¹äºå°†ä¸€äº›â€œä¸œè¥¿â€è½¬æ¢ä¸ºæ•°ç»„çš„ä»»åŠ¡ï¼Œ`Array.from` å¾€å¾€æ›´é€šç”¨ã€‚

### å¤åˆ¶ array/object

è¿˜è®°å¾—æˆ‘ä»¬ [ä¹‹å‰è®²è¿‡çš„](https://zh.javascript.info/object-copy#ke-long-yu-he-bing-objectassign) `Object.assign()` å—ï¼Ÿ

ä½¿ç”¨ spread è¯­æ³•ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹æƒ…ï¼ˆè¯‘æ³¨ï¼šä¹Ÿå°±æ˜¯è¿›è¡Œæµ…æ‹·è´ï¼‰ã€‚

```javascript
let arr = [1, 2, 3];

let arrCopy = [...arr]; // å°†æ•°ç»„ spread åˆ°å‚æ•°åˆ—è¡¨ä¸­
                        // ç„¶åå°†ç»“æœæ”¾åˆ°ä¸€ä¸ªæ–°æ•°ç»„

// ä¸¤ä¸ªæ•°ç»„ä¸­çš„å†…å®¹ç›¸åŒå—ï¼Ÿ
alert(JSON.stringify(arr) === JSON.stringify(arrCopy)); // true

// ä¸¤ä¸ªæ•°ç»„ç›¸ç­‰å—ï¼Ÿ
alert(arr === arrCopy); // falseï¼ˆå®ƒä»¬çš„å¼•ç”¨æ˜¯ä¸åŒçš„ï¼‰

// ä¿®æ”¹æˆ‘ä»¬åˆå§‹çš„æ•°ç»„ä¸ä¼šä¿®æ”¹å‰¯æœ¬ï¼š
arr.push(4);
alert(arr); // 1, 2, 3, 4
alert(arrCopy); // 1, 2, 3
```

å¹¶ä¸”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹å¼æ¥å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼š

```javascript
let obj = { a: 1, b: 2, c: 3 };

let objCopy = { ...obj }; // å°†å¯¹è±¡ spread åˆ°å‚æ•°åˆ—è¡¨ä¸­
                          // ç„¶åå°†ç»“æœè¿”å›åˆ°ä¸€ä¸ªæ–°å¯¹è±¡

// ä¸¤ä¸ªå¯¹è±¡ä¸­çš„å†…å®¹ç›¸åŒå—ï¼Ÿ
alert(JSON.stringify(obj) === JSON.stringify(objCopy)); // true

// ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰å—ï¼Ÿ
alert(obj === objCopy); // false (not same reference)

// ä¿®æ”¹æˆ‘ä»¬åˆå§‹çš„å¯¹è±¡ä¸ä¼šä¿®æ”¹å‰¯æœ¬ï¼š
obj.d = 4;
alert(JSON.stringify(obj)); // {"a":1,"b":2,"c":3,"d":4}
alert(JSON.stringify(objCopy)); // {"a":1,"b":2,"c":3}
```

è¿™ç§æ–¹å¼æ¯”ä½¿ç”¨ `let arrCopy = Object.assign([], arr)` å¤åˆ¶æ•°ç»„ï¼Œæˆ–ä½¿ç”¨ `let objCopy = Object.assign({}, obj)` å¤åˆ¶å¯¹è±¡æ¥è¯´æ›´ä¸ºç®€ä¾¿ã€‚å› æ­¤ï¼Œåªè¦æƒ…å†µå…è®¸ï¼Œæˆ‘ä»¬å€¾å‘äºä½¿ç”¨å®ƒã€‚

### æ€»ç»“

å½“æˆ‘ä»¬åœ¨ä»£ç ä¸­çœ‹åˆ° `"..."` æ—¶ï¼Œå®ƒè¦ä¹ˆæ˜¯ rest å‚æ•°ï¼Œè¦ä¹ˆæ˜¯ spread è¯­æ³•ã€‚

æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥åŒºåˆ†å®ƒä»¬ï¼š

- è‹¥ `...` å‡ºç°åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨çš„æœ€åï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ rest å‚æ•°ï¼Œå®ƒä¼šæŠŠå‚æ•°åˆ—è¡¨ä¸­å‰©ä½™çš„å‚æ•°æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚
- è‹¥ `...` å‡ºç°åœ¨å‡½æ•°è°ƒç”¨æˆ–ç±»ä¼¼çš„è¡¨è¾¾å¼ä¸­ï¼Œé‚£å®ƒå°±æ˜¯ spread è¯­æ³•ï¼Œå®ƒä¼šæŠŠä¸€ä¸ªæ•°ç»„å±•å¼€ä¸ºåˆ—è¡¨ã€‚

ä½¿ç”¨åœºæ™¯ï¼š

- Rest å‚æ•°ç”¨äºåˆ›å»ºå¯æ¥å—ä»»æ„æ•°é‡å‚æ•°çš„å‡½æ•°ã€‚
- Spread è¯­æ³•ç”¨äºå°†æ•°ç»„ä¼ é€’ç»™é€šå¸¸éœ€è¦å«æœ‰è®¸å¤šå‚æ•°çš„å‡½æ•°ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸¤ç§è¯­æ³•è½»æ¾åœ°äº’ç›¸è½¬æ¢åˆ—è¡¨ä¸å‚æ•°æ•°ç»„ã€‚

æ—§å¼çš„ `arguments`ï¼ˆç±»æ•°ç»„ä¸”å¯è¿­ä»£çš„å¯¹è±¡ï¼‰ä¹Ÿä¾ç„¶èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è·å–å‡½æ•°è°ƒç”¨ä¸­çš„æ‰€æœ‰å‚æ•°ã€‚

## æ„é€ å‡½æ•°æ–°å¢çš„æ–¹æ³•

å…³äºæ„é€ å‡½æ•°ï¼Œæ•°ç»„æ–°å¢çš„æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š

- Array.from()
- Array.of()

### Array.from()

å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡å’Œå¯éå†`ï¼ˆiterableï¼‰`çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ `ES6` æ–°å¢çš„æ•°æ®ç»“æ„ `Set` å’Œ `Map`ï¼‰

```js
let arrayLike = {
    '0': 'a',
    '1': 'b',
    '2': 'c',
    length: 3
};
let arr2 = Array.from(arrayLike); // ['a', 'b', 'c']
```

è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„

```js
Array.from([1, 2, 3], (x) => x * x)
// [1, 4, 9]
```

### Array.of()

ç”¨äºå°†ä¸€ç»„å€¼ï¼Œè½¬æ¢ä¸ºæ•°ç»„

```js
Array.of(3, 11, 8) // [3,11,8]
```

æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„

å½“å‚æ•°åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯æŒ‡å®šæ•°ç»„çš„é•¿åº¦

å‚æ•°ä¸ªæ•°ä¸å°‘äº 2 ä¸ªæ—¶ï¼Œ`Array()`æ‰ä¼šè¿”å›ç”±å‚æ•°ç»„æˆçš„æ–°æ•°ç»„

```js
Array() // []
Array(3) // [, , ,]
Array(3, 11, 8) // [3, 11, 8]
```

## å®ä¾‹å¯¹è±¡æ–°å¢çš„æ–¹æ³•

å…³äºæ•°ç»„å®ä¾‹å¯¹è±¡æ–°å¢çš„æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š

- copyWithin()
- find()ã€findIndex()
- fill()
- entries()ï¼Œkeys()ï¼Œvalues()
- includes()
- flat()ï¼ŒflatMap()

### copyWithin()

å°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„

å‚æ•°å¦‚ä¸‹ï¼š

- targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚
- startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚
- endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚

```js
[1, 2, 3, 4, 5].copyWithin(0, 3) // å°†ä» 3 å·ä½ç›´åˆ°æ•°ç»„ç»“æŸçš„æˆå‘˜ï¼ˆ4 å’Œ 5ï¼‰ï¼Œå¤åˆ¶åˆ°ä» 0 å·ä½å¼€å§‹çš„ä½ç½®ï¼Œç»“æœè¦†ç›–äº†åŸæ¥çš„ 1 å’Œ 2
// [4, 5, 3, 4, 5] 
```

### find()ã€findIndex()

`find()`ç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜

å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ä¾æ¬¡ä¸ºå½“å‰çš„å€¼ã€å½“å‰çš„ä½ç½®å’ŒåŸæ•°ç»„

```js
[1, 5, 10, 15].find(function(value, index, arr) {
  return value > 9;
}) // 10
```

`findIndex`è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æœæ‰€æœ‰æˆå‘˜éƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›-1

```js
[1, 5, 10, 15].findIndex(function(value, index, arr) {
  return value > 9;
}) // 2
```

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°çš„`this`å¯¹è±¡ã€‚

```js
function f(v){
  return v > this.age;
}
let person = {name: 'John', age: 20};
[10, 12, 26, 15].find(f, person);    // 26
```

### fill()

ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„

```javascript
['a', 'b', 'c'].fill(7)
// [7, 7, 7]

new Array(3).fill(7)
// [7, 7, 7]
```

è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šå¡«å……çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®

```js
['a', 'b', 'c'].fill(7, 1, 2)
// ['a', 7, 'c']
```

æ³¨æ„ï¼Œå¦‚æœå¡«å……çš„ç±»å‹ä¸ºå¯¹è±¡ï¼Œåˆ™æ˜¯æµ…æ‹·è´

### entries()ï¼Œkeys()ï¼Œvalues()

`keys()`æ˜¯å¯¹é”®åçš„éå†ã€`values()`æ˜¯å¯¹é”®å€¼çš„éå†ï¼Œ`entries()`æ˜¯å¯¹é”®å€¼å¯¹çš„éå†

```js
or (let index of ['a', 'b'].keys()) {
  console.log(index);
}
// 0
// 1

for (let elem of ['a', 'b'].values()) {
  console.log(elem);
}
// 'a'
// 'b'

for (let [index, elem] of ['a', 'b'].entries()) {
  console.log(index, elem);
}
// 0 "a"
```

### includes()

ç”¨äºåˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼

```js
[1, 2, 3].includes(2)     // true
[1, 2, 3].includes(4)     // false
[1, 2, NaN].includes(NaN) // true
```

æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæœç´¢çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º`0`

å‚æ•°ä¸ºè´Ÿæ•°åˆ™è¡¨ç¤ºå€’æ•°çš„ä½ç½®

```js
[1, 2, 3].includes(3, 3);  // false
[1, 2, 3].includes(3, -1); // true
```

### flat()ï¼ŒflatMap()

å°†æ•°ç»„æ‰å¹³åŒ–å¤„ç†ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŸæ•°æ®æ²¡æœ‰å½±å“

```js
[1, 2, [3, 4]].flat()
// [1, 2, 3, 4]
```

`flat()`é»˜è®¤åªä¼šâ€œæ‹‰å¹³â€ä¸€å±‚ï¼Œå¦‚æœæƒ³è¦â€œæ‹‰å¹³â€å¤šå±‚çš„åµŒå¥—æ•°ç»„ï¼Œå¯ä»¥å°†`flat()`æ–¹æ³•çš„å‚æ•°å†™æˆä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæƒ³è¦æ‹‰å¹³çš„å±‚æ•°ï¼Œé»˜è®¤ä¸º1

```js
[1, 2, [3, [4, 5]]].flat()
// [1, 2, 3, [4, 5]]

[1, 2, [3, [4, 5]]].flat(2)
// [1, 2, 3, 4, 5]
```

`flatMap()`æ–¹æ³•å¯¹åŸæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œä¸€ä¸ªå‡½æ•°ç›¸å½“äºæ‰§è¡Œ`Array.prototype.map()`ï¼Œç„¶åå¯¹è¿”å›å€¼ç»„æˆçš„æ•°ç»„æ‰§è¡Œ`flat()`æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œä¸æ”¹å˜åŸæ•°ç»„

```js
// ç›¸å½“äº [[2, 4], [3, 6], [4, 8]].flat()
[2, 3, 4].flatMap((x) => [x, x * 2])
// [2, 4, 3, 6, 4, 8]
```

`flatMap()`æ–¹æ³•è¿˜å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šéå†å‡½æ•°é‡Œé¢çš„this

### å››ã€æ•°ç»„çš„ç©ºä½

æ•°ç»„çš„ç©ºä½æŒ‡ï¼Œæ•°ç»„çš„æŸä¸€ä¸ªä½ç½®æ²¡æœ‰ä»»ä½•å€¼

ES6 åˆ™æ˜¯æ˜ç¡®å°†ç©ºä½è½¬ä¸º`undefined`ï¼ŒåŒ…æ‹¬`Array.from`ã€æ‰©å±•è¿ç®—ç¬¦ã€`copyWithin()`ã€`fill()`ã€`entries()`ã€`keys()`ã€`values()`ã€`find()`å’Œ`findIndex()`

å»ºè®®å¤§å®¶åœ¨æ—¥å¸¸ä¹¦å†™ä¸­ï¼Œé¿å…å‡ºç°ç©ºä½

### äº”ã€æ’åºç¨³å®šæ€§

å°†`sort()`é»˜è®¤è®¾ç½®ä¸ºç¨³å®šçš„æ’åºç®—æ³•

```js
const arr = [
  'peach',
  'straw',
  'apple',
  'spork'
];

const stableSorting = (s1, s2) => {
  if (s1[0] < s2[0]) return -1;
  return 1;
};

arr.sort(stableSorting)
// ["apple", "peach", "straw", "spork"]
```

æ’åºç»“æœä¸­ï¼Œ`straw`åœ¨`spork`çš„å‰é¢ï¼Œè·ŸåŸå§‹é¡ºåºä¸€è‡´





# 2. ES6ä¸­å¯¹è±¡æ–°å¢äº†å“ªäº›æ‰©å±•ï¼Ÿ

![img](https://static.vue-js.com/4da4dd40-5427-11eb-ab90-d9ae814b240d.png)

## ä¸€ã€å±æ€§çš„ç®€å†™

ES6ä¸­ï¼Œå½“å¯¹è±¡é”®åä¸å¯¹åº”å€¼åç›¸ç­‰çš„æ—¶å€™ï¼Œå¯ä»¥è¿›è¡Œç®€å†™

```js
const baz = {foo:foo}

// ç­‰åŒäº
const baz = {foo}
```

æ–¹æ³•ä¹Ÿèƒ½å¤Ÿè¿›è¡Œç®€å†™

```js
const o = {
  method() {
    return "Hello!";
  }
};

// ç­‰åŒäº

const o = {
  method: function() {
    return "Hello!";
  }
}
```

åœ¨å‡½æ•°å†…ä½œä¸ºè¿”å›å€¼ï¼Œä¹Ÿä¼šå˜å¾—æ–¹ä¾¿å¾ˆå¤š

```js
function getPoint() {
  const x = 1;
  const y = 10;
  return {x, y};
}

getPoint()
// {x:1, y:10}
```

æ³¨æ„ï¼šç®€å†™çš„å¯¹è±¡æ–¹æ³•ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```js
const obj = {
  f() {
    this.foo = 'bar';
  }
};

new obj.f() // æŠ¥é”™
```



## äºŒã€å®ä¾‹å±æ€§å’Œæ–¹æ³•

```js
class Person{
  // å®ä¾‹å±æ€§
  temp = 'briup';
  constructor(name,age){
    // å®ä¾‹å±æ€§  å¸¸ç”¨
    this.name = name;
    this.age = age;
    // å®ä¾‹æ–¹æ³•  ä¸å¸¸ç”¨
    this.sayName = function(){
      console.log("i am ",this.name);
    }
  }
}
let p1 = new Person('Ronda',22);
let p2 = new Person('Fairy',23);
console.log(p1.sayName === p2.sayName);  // false å› ä¸ºæ˜¯å®ä¾‹æ–¹æ³•ï¼Œæ‰€æœ‰æ¯ä¸ªå®ä¾‹å†…éƒ½ä¼šæœ‰è‡ªå·±çš„æ–¹æ³•
console.log(p1.name);  // Ronda
console.log(p1.temp);  // briup
p1.sayName();  // i am Ronda
```

## ä¸‰ã€åŸå‹å±æ€§å’Œæ–¹æ³•

åŸå‹å±æ€§å’Œæ–¹æ³•é¡¾åæ€ä¹‰å°±æ˜¯åœ¨æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šå­˜åœ¨çš„å±æ€§å’Œæ–¹æ³•ã€‚

```javascript
class Person {
  constructor(name, age) {
    this.name = name;
    this.age = age;
  }
  // åŸå‹æ–¹æ³• å¸¸ç”¨
  sayName() {
    console.log("i am ", this.name);
  }
}
// åŸå‹å±æ€§ ä¸å¸¸ç”¨
Person.prototype.temp = 'briup';
let p1 = new Person('Ronda', 22);
let p2 = new Person('Fairy', 23);
p1.sayName();   // i am  Ronda
console.log(p1.sayName === p2.sayName);  // true
console.log(p1.temp);  // briup
console.log(p2.temp);  // briup
```

### é™æ€å±æ€§å’Œæ–¹æ³•

é€šè¿‡**`static`**å…³é”®å­—æ¥å®šä¹‰é™æ€å±æ€§å’Œé™æ€æ–¹æ³•ã€‚é™æ€å±æ€§å’Œé™æ€æ–¹æ³•æ˜¯å®šä¹‰åœ¨ç±»ä¸Šçš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç±»ç›´æ¥è®¿é—®ã€‚åœ¨é™æ€æ–¹æ³•ä¸­ï¼Œ`this`æŒ‡å‘å½“å‰ç±»ã€‚

```js
class Person {
  // é™æ€å±æ€§
  static num = 200;
  // é™æ€æ–¹æ³•
  static number() {
    console.log(this); // [class Person] { num: 200 }
    return this.num;
  }
}
console.log(Person);  // [class Person] { num: 200 }
console.log(Person.number());	//200
console.log(Person.num);	//200
```



## å››ã€superå…³é”®å­—

`this`å…³é”®å­—æ€»æ˜¯æŒ‡å‘å‡½æ•°æ‰€åœ¨çš„å½“å‰å¯¹è±¡ï¼ŒES6 åˆæ–°å¢äº†å¦ä¸€ä¸ªç±»ä¼¼çš„å…³é”®å­—`super`ï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡

```javascript
const proto = {
  foo: 'hello'
};

const obj = {
  foo: 'world',
  find() {
    return super.foo;
  }
};

Object.setPrototypeOf(obj, proto); // ä¸ºobjè®¾ç½®åŸå‹å¯¹è±¡
obj.find() // "hello"
```

## äº”ã€æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨

åœ¨è§£æ„èµ‹å€¼ä¸­ï¼Œæœªè¢«è¯»å–çš„å¯éå†çš„å±æ€§ï¼Œåˆ†é…åˆ°æŒ‡å®šçš„å¯¹è±¡ä¸Šé¢

```js
let { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 };
x // 1
y // 2
z // { a: 3, b: 4 }
```

æ³¨æ„ï¼šè§£æ„èµ‹å€¼å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™

è§£æ„èµ‹å€¼æ˜¯æµ…æ‹·è´

```js
let obj = { a: { b: 1 } };
let { ...x } = obj;
obj.a.b = 2; // ä¿®æ”¹objé‡Œé¢aå±æ€§ä¸­é”®å€¼
x.a.b // 2ï¼Œå½±å“åˆ°äº†ç»“æ„å‡ºæ¥xçš„å€¼
```

å¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦ç­‰åŒäºä½¿ç”¨`Object.assign()`æ–¹æ³•

## å…­ã€å±æ€§çš„éå†

ES6 ä¸€å…±æœ‰ 5 ç§æ–¹æ³•å¯ä»¥éå†å¯¹è±¡çš„å±æ€§ã€‚

- for...inï¼šå¾ªç¯éå†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æšä¸¾å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼‰
- Object.keys(obj)ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼‰çš„é”®å
- Object.getOwnPropertyNames(obj)ï¼šå›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼Œä½†æ˜¯åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰çš„é”®å
- Object.getOwnPropertySymbols(obj)ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰ Symbol å±æ€§çš„é”®å
- Reflect.ownKeys(obj)ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰é”®åï¼Œä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾

ä¸Šè¿°éå†ï¼Œéƒ½éµå®ˆåŒæ ·çš„å±æ€§éå†çš„æ¬¡åºè§„åˆ™ï¼š

- é¦–å…ˆéå†æ‰€æœ‰æ•°å€¼é”®ï¼ŒæŒ‰ç…§æ•°å€¼å‡åºæ’åˆ—
- å…¶æ¬¡éå†æ‰€æœ‰å­—ç¬¦ä¸²é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—
- æœ€åéå†æ‰€æœ‰ Symbol é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’

```js
Reflect.ownKeys({ [Symbol()]:0, b:0, 10:0, 2:0, a:0 })
// ['2', '10', 'b', 'a', Symbol()]
```

## ä¸ƒã€å¯¹è±¡æ–°å¢çš„æ–¹æ³•

å…³äºå¯¹è±¡æ–°å¢çš„æ–¹æ³•ï¼Œåˆ†åˆ«æœ‰ä»¥ä¸‹ï¼š

- Object.is()
- Object.assign()
- Object.getOwnPropertyDescriptors()
- Object.setPrototypeOf()ï¼ŒObject.getPrototypeOf()
- Object.keys()ï¼ŒObject.values()ï¼ŒObject.entries()
- Object.fromEntries()

### Object.is()

ä¸¥æ ¼åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ä¸¥æ ¼æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ===ï¼‰çš„è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åªæœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯`+0`ä¸ç­‰äº`-0`ï¼ŒäºŒæ˜¯`NaN`ç­‰äºè‡ªèº«

```js
+0 === -0 //true
NaN === NaN // false

Object.is(+0, -0) // false
Object.is(NaN, NaN) // true
```

### Object.assign()

`Object.assign()`æ–¹æ³•ç”¨äºå¯¹è±¡çš„åˆå¹¶ï¼Œå°†æºå¯¹è±¡`source`çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œå¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡target

`Object.assign()`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯æºå¯¹è±¡

```javascript
const target = { a: 1, b: 1 };

const source1 = { b: 2, c: 2 };
const source2 = { c: 3 };

Object.assign(target, source1, source2);
target // {a:1, b:2, c:3}
```

æ³¨æ„ï¼š`Object.assign()`æ–¹æ³•æ˜¯æµ…æ‹·è´ï¼Œé‡åˆ°åŒåå±æ€§ä¼šè¿›è¡Œæ›¿æ¢

### Object.getOwnPropertyDescriptors()

è¿”å›æŒ‡å®šå¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆéç»§æ‰¿å±æ€§ï¼‰çš„æè¿°å¯¹è±¡

```js
const obj = {
  foo: 123,
  get bar() { return 'abc' }
};

Object.getOwnPropertyDescriptors(obj)
// { foo:
//    { value: 123,
//      writable: true,
//      enumerable: true,
//      configurable: true },
//   bar:
//    { get: [Function: get bar],
//      set: undefined,
//      enumerable: true,
//      configurable: true } }
```

### Object.setPrototypeOf()

`Object.setPrototypeOf`æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡

```js
Object.setPrototypeOf(object, prototype)

// ç”¨æ³•
const o = Object.setPrototypeOf({}, null);
```

### Object.getPrototypeOf()

ç”¨äºè¯»å–ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡

```js
Object.getPrototypeOf(obj);
```

### Object.keys()

è¿”å›è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®åçš„æ•°ç»„

```js
var obj = { foo: 'bar', baz: 42 };
Object.keys(obj)
// ["foo", "baz"]
```

### Object.values()

è¿”å›è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å¯¹åº”å€¼çš„æ•°ç»„

```js
const obj = { foo: 'bar', baz: 42 };
Object.values(obj)
// ["bar", 42]
```

### Object.entries()

è¿”å›ä¸€ä¸ªå¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼å¯¹çš„æ•°ç»„

```js
const obj = { foo: 'bar', baz: 42 };
Object.entries(obj)
// [ ["foo", "bar"], ["baz", 42] ]
```

### Object.fromEntries()

ç”¨äºå°†ä¸€ä¸ªé”®å€¼å¯¹æ•°ç»„è½¬ä¸ºå¯¹è±¡

```js
Object.fromEntries([
  ['foo', 'bar'],
  ['baz', 42]
])
// { foo: "bar", baz: 42 }
```







# 3. ES6ä¸­å‡½æ•°æ–°å¢äº†å“ªäº›æ‰©å±•ï¼Ÿ

![img](https://static.vue-js.com/54a04a10-5569-11eb-85f6-6fac77c0c9b3.png)

## ä¸€ã€å‚æ•°

`ES6`å…è®¸ä¸ºå‡½æ•°çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼

```js
function log(x, y = 'World') {
  console.log(x, y);
}

console.log('Hello') // Hello World
console.log('Hello', 'China') // Hello China
console.log('Hello', '') // Hello
```

å‡½æ•°çš„å½¢å‚æ˜¯é»˜è®¤å£°æ˜çš„ï¼Œä¸èƒ½ä½¿ç”¨`let`æˆ–`const`å†æ¬¡å£°æ˜

```js
function foo(x = 5) {
    let x = 1; // error
    const x = 2; // error
}
```

å‚æ•°é»˜è®¤å€¼å¯ä»¥ä¸è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼ç»“åˆèµ·æ¥ä½¿ç”¨

```js
function foo({x, y = 5}) {
  console.log(x, y);
}

foo({}) // undefined 5
foo({x: 1}) // 1 5
foo({x: 1, y: 2}) // 1 2
foo() // TypeError: Cannot read property 'x' of undefined
```

ä¸Šé¢çš„`foo`å‡½æ•°ï¼Œå½“å‚æ•°ä¸ºå¯¹è±¡çš„æ—¶å€™æ‰èƒ½è¿›è¡Œè§£æ„ï¼Œå¦‚æœæ²¡æœ‰æä¾›å‚æ•°çš„æ—¶å€™ï¼Œå˜é‡`x`å’Œ`y`å°±ä¸ä¼šç”Ÿæˆï¼Œä»è€ŒæŠ¥é”™ï¼Œè¿™é‡Œè®¾ç½®é»˜è®¤å€¼é¿å…

```js
function foo({x, y = 5} = {}) {
  console.log(x, y);
}

foo() // undefined 5
```

å‚æ•°é»˜è®¤å€¼åº”è¯¥æ˜¯å‡½æ•°çš„å°¾å‚æ•°ï¼Œå¦‚æœä¸æ˜¯éå°¾éƒ¨çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå®é™…ä¸Šè¿™ä¸ªå‚æ•°æ˜¯æ²¡å‘çœç•¥çš„

```javascript
function f(x = 1, y) {
  return [x, y];
}

f() // [1, undefined]
f(2) // [2, undefined]
f(, 1) // æŠ¥é”™
f(undefined, 1) // [1, 1]
```

## äºŒã€å±æ€§

### å‡½æ•°çš„lengthå±æ€§

`length`å°†è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°

```js
(function (a) {}).length // 1
(function (a = 5) {}).length // 0
(function (a, b, c = 5) {}).length // 2
```

`rest` å‚æ•°ä¹Ÿä¸ä¼šè®¡å…¥`length`å±æ€§

```js
(function(...args) {}).length // 0
```

å¦‚æœè®¾ç½®äº†é»˜è®¤å€¼çš„å‚æ•°ä¸æ˜¯å°¾å‚æ•°ï¼Œé‚£ä¹ˆ`length`å±æ€§ä¹Ÿä¸å†è®¡å…¥åé¢çš„å‚æ•°äº†

```js
(function (a = 0, b, c) {}).length // 0
(function (a, b = 1, c) {}).length // 1
```

### nameå±æ€§

è¿”å›è¯¥å‡½æ•°çš„å‡½æ•°å

```js
var f = function () {};

// ES5
f.name // ""

// ES6
f.name // "f"
```

å¦‚æœå°†ä¸€ä¸ªå…·åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œåˆ™ `name`å±æ€§éƒ½è¿”å›è¿™ä¸ªå…·åå‡½æ•°åŸæœ¬çš„åå­—

```js
const bar = function baz() {};
bar.name // "baz"
```

```
Function`æ„é€ å‡½æ•°è¿”å›çš„å‡½æ•°å®ä¾‹ï¼Œ`name`å±æ€§çš„å€¼ä¸º`anonymous
(new Function).name // "anonymous"
```

`bind`è¿”å›çš„å‡½æ•°ï¼Œ`name`å±æ€§å€¼ä¼šåŠ ä¸Š`bound`å‰ç¼€

```javascript
function foo() {};
foo.bind({}).name // "bound foo"

(function(){}).bind({}).name // "bound "
```

## ä¸‰ã€ä½œç”¨åŸŸ

ä¸€æ—¦è®¾ç½®äº†å‚æ•°çš„é»˜è®¤å€¼ï¼Œå‡½æ•°è¿›è¡Œå£°æ˜åˆå§‹åŒ–æ—¶ï¼Œå‚æ•°ä¼šå½¢æˆä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸ

ç­‰åˆ°åˆå§‹åŒ–ç»“æŸï¼Œè¿™ä¸ªä½œç”¨åŸŸå°±ä¼šæ¶ˆå¤±ã€‚è¿™ç§è¯­æ³•è¡Œä¸ºï¼Œåœ¨ä¸è®¾ç½®å‚æ•°é»˜è®¤å€¼æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºç°çš„

ä¸‹é¢ä¾‹å­ä¸­ï¼Œ`y=x`ä¼šå½¢æˆä¸€ä¸ªå•ç‹¬ä½œç”¨åŸŸï¼Œ`x`æ²¡æœ‰è¢«å®šä¹‰ï¼Œæ‰€ä»¥æŒ‡å‘å…¨å±€å˜é‡`x`

```js
let x = 1;

function f(y = x) { 
  // ç­‰åŒäº let y = x  
  let x = 2; 
  console.log(y);
}

f() // 1
```

## å››ã€ä¸¥æ ¼æ¨¡å¼

åªè¦å‡½æ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æ„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°å†…éƒ¨å°±ä¸èƒ½æ˜¾å¼è®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```js
// æŠ¥é”™
function doSomething(a, b = a) {
  'use strict';
  // code
}

// æŠ¥é”™
const doSomething = function ({a, b}) {
  'use strict';
  // code
};

// æŠ¥é”™
const doSomething = (...a) => {
  'use strict';
  // code
};

const obj = {
  // æŠ¥é”™
  doSomething({a, b}) {
    'use strict';
    // code
  }
};
```



## äº”ã€â€œç®­å¤´â€ï¼ˆ`=>`ï¼‰å®šä¹‰å‡½æ•°

```js
var f = v => v;

// ç­‰åŒäº
var f = function (v) {
  return v;
};
```

å¦‚æœç®­å¤´å‡½æ•°ä¸éœ€è¦å‚æ•°æˆ–éœ€è¦å¤šä¸ªå‚æ•°ï¼Œå°±ä½¿ç”¨ä¸€ä¸ªåœ†æ‹¬å·ä»£è¡¨å‚æ•°éƒ¨åˆ†

```js
var f = () => 5;
// ç­‰åŒäº
var f = function () { return 5 };

var sum = (num1, num2) => num1 + num2;
// ç­‰åŒäº
var sum = function(num1, num2) {
  return num1 + num2;
};
```

å¦‚æœç®­å¤´å‡½æ•°çš„ä»£ç å—éƒ¨åˆ†å¤šäºä¸€æ¡è¯­å¥ï¼Œå°±è¦ä½¿ç”¨å¤§æ‹¬å·å°†å®ƒä»¬æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨`return`è¯­å¥è¿”å›

```js
var sum = (num1, num2) => { return num1 + num2; }
```

å¦‚æœè¿”å›å¯¹è±¡ï¼Œéœ€è¦åŠ æ‹¬å·å°†å¯¹è±¡åŒ…è£¹

```js
let getTempItem = id => ({ id: id, name: "Temp" });
```

æ³¨æ„ç‚¹ï¼š

- å‡½æ•°ä½“å†…çš„`this`å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡
- ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨`new`å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯
- ä¸å¯ä»¥ä½¿ç”¨`arguments`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨ `rest` å‚æ•°ä»£æ›¿
- ä¸å¯ä»¥ä½¿ç”¨`yield`å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°





# 4. æ€ä¹ˆç†è§£ES6æ–°å¢Setã€Mapä¸¤ç§æ•°æ®ç»“æ„çš„ï¼Ÿ

![img](https://static.vue-js.com/2b947d00-560c-11eb-85f6-6fac77c0c9b3.png)

å¦‚æœè¦ç”¨ä¸€å¥æ¥æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥è¯´

`Set`æ˜¯ä¸€ç§å«åšé›†åˆçš„æ•°æ®ç»“æ„ï¼Œ`Map`æ˜¯ä¸€ç§å«åšå­—å…¸çš„æ•°æ®ç»“æ„

ä»€ä¹ˆæ˜¯é›†åˆï¼Ÿä»€ä¹ˆåˆæ˜¯å­—å…¸ï¼Ÿ

- é›†åˆ
  æ˜¯ç”±ä¸€å †æ— åºçš„ã€ç›¸å…³è”çš„ï¼Œä¸”ä¸é‡å¤çš„å†…å­˜ç»“æ„ã€æ•°å­¦ä¸­ç§°ä¸ºå…ƒç´ ã€‘ç»„æˆçš„ç»„åˆ
- å­—å…¸
  æ˜¯ä¸€äº›å…ƒç´ çš„é›†åˆã€‚æ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªç§°ä½œkey çš„åŸŸï¼Œä¸åŒå…ƒç´ çš„key å„ä¸ç›¸åŒ

åŒºåˆ«ï¼Ÿ

- å…±åŒç‚¹ï¼šé›†åˆã€å­—å…¸éƒ½å¯ä»¥å­˜å‚¨ä¸é‡å¤çš„å€¼
- ä¸åŒç‚¹ï¼šé›†åˆæ˜¯ä»¥[å€¼ï¼Œå€¼]çš„å½¢å¼å­˜å‚¨å…ƒç´ ï¼Œå­—å…¸æ˜¯ä»¥[é”®ï¼Œå€¼]çš„å½¢å¼å­˜å‚¨

## ä¸€ã€Set

`Set`æ˜¯`es6`æ–°å¢çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºé›†åˆ

`Set`æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Set æ•°æ®ç»“æ„

```js
const s = new Set();
```

### å¢åˆ æ”¹æŸ¥

`Set`çš„å®ä¾‹å…³äºå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•ï¼š

- add()
- delete()
- has()
- clear()

### add()

æ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å› `Set` ç»“æ„æœ¬èº«

å½“æ·»åŠ å®ä¾‹ä¸­å·²ç»å­˜åœ¨çš„å…ƒç´ ï¼Œ`set`ä¸ä¼šè¿›è¡Œå¤„ç†æ·»åŠ 

```js
s.add(1).add(2).add(2); // 2åªè¢«æ·»åŠ äº†ä¸€æ¬¡
```

### delete()

åˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸ

```js
s.delete(1)
```

### has()

è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œåˆ¤æ–­è¯¥å€¼æ˜¯å¦ä¸º`Set`çš„æˆå‘˜

```js
s.has(2)
```

### clear()

æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼

```js
s.clear()
```

### éå†

`Set`å®ä¾‹éå†çš„æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š

å…³äºéå†çš„æ–¹æ³•ï¼Œæœ‰å¦‚ä¸‹ï¼š

- keys()ï¼šè¿”å›é”®åçš„éå†å™¨
- values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨
- entries()ï¼šè¿”å›é”®å€¼å¯¹çš„éå†å™¨
- forEach()ï¼šä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜

`Set`çš„éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº

`keys`æ–¹æ³•ã€`values`æ–¹æ³•ã€`entries`æ–¹æ³•è¿”å›çš„éƒ½æ˜¯éå†å™¨å¯¹è±¡

```javascript
let set = new Set(['red', 'green', 'blue']);

for (let item of set.keys()) {
  console.log(item);
}
// red
// green
// blue

for (let item of set.values()) {
  console.log(item);
}
// red
// green
// blue

for (let item of set.entries()) {
  console.log(item);
}
// ["red", "red"]
// ["green", "green"]
// ["blue", "blue"]
```

`forEach()`ç”¨äºå¯¹æ¯ä¸ªæˆå‘˜æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œé”®å€¼ã€é”®åéƒ½ç›¸ç­‰ï¼ŒåŒæ ·çš„`forEach`æ–¹æ³•æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºç»‘å®šå¤„ç†å‡½æ•°çš„this

```js
let set = new Set([1, 4, 9]);
set.forEach((value, key) => console.log(key + ' : ' + value))
// 1 : 1
// 4 : 4
// 9 : 9
```

æ‰©å±•è¿ç®—ç¬¦å’Œ`Set` ç»“æ„ç›¸ç»“åˆå®ç°æ•°ç»„æˆ–å­—ç¬¦ä¸²å»é‡

```javascript
// æ•°ç»„
let arr = [3, 5, 2, 2, 5, 5];
let unique = [...new Set(arr)]; // [3, 5, 2]

// å­—ç¬¦ä¸²
let str = "352255";
let unique = [...new Set(str)].join(""); // "352"
```

å®ç°å¹¶é›†ã€äº¤é›†ã€å’Œå·®é›†

```javascript
let a = new Set([1, 2, 3]);
let b = new Set([4, 3, 2]);

// å¹¶é›†
let union = new Set([...a, ...b]);
// Set {1, 2, 3, 4}

// äº¤é›†
let intersect = new Set([...a].filter(x => b.has(x)));
// set {2, 3}

// ï¼ˆa ç›¸å¯¹äº b çš„ï¼‰å·®é›†
let difference = new Set([...a].filter(x => !b.has(x)));
// Set {1}
```

## äºŒã€Map

`Map`ç±»å‹æ˜¯é”®å€¼å¯¹çš„æœ‰åºåˆ—è¡¨ï¼Œè€Œé”®å’Œå€¼éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹

`Map`æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ `Map` æ•°æ®ç»“æ„

```js
const m = new Map()
```

### å¢åˆ æ”¹æŸ¥

`Map` ç»“æ„çš„å®ä¾‹é’ˆå¯¹å¢åˆ æ”¹æŸ¥æœ‰ä»¥ä¸‹å±æ€§å’Œæ“ä½œæ–¹æ³•ï¼š

- size å±æ€§
- set()
- get()
- has()
- delete()
- clear()

### size

`size`å±æ€§è¿”å› Map ç»“æ„çš„æˆå‘˜æ€»æ•°ã€‚

```javascript
const map = new Map();
map.set('foo', true);
map.set('bar', false);

map.size // 2
```

### set()

è®¾ç½®é”®å`key`å¯¹åº”çš„é”®å€¼ä¸º`value`ï¼Œç„¶åè¿”å›æ•´ä¸ª Map ç»“æ„

å¦‚æœ`key`å·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®

åŒæ—¶è¿”å›çš„æ˜¯å½“å‰`Map`å¯¹è±¡ï¼Œå¯é‡‡ç”¨é“¾å¼å†™æ³•

```javascript
const m = new Map();

m.set('edition', 6)        // é”®æ˜¯å­—ç¬¦ä¸²
m.set(262, 'standard')     // é”®æ˜¯æ•°å€¼
m.set(undefined, 'nah')    // é”®æ˜¯ undefined
m.set(1, 'a').set(2, 'b').set(3, 'c') // é“¾å¼æ“ä½œ
```

### get()

`get`æ–¹æ³•è¯»å–`key`å¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°`key`ï¼Œè¿”å›`undefined`

```js
const m = new Map();

const hello = function() {console.log('hello');};
m.set(hello, 'Hello ES6!') // é”®æ˜¯å‡½æ•°

m.get(hello)  // Hello ES6!
```

### has()

`has`æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨å½“å‰ Map å¯¹è±¡ä¹‹ä¸­

```javascript
const m = new Map();

m.set('edition', 6);
m.set(262, 'standard');
m.set(undefined, 'nah');

m.has('edition')     // true
m.has('years')       // false
m.has(262)           // true
m.has(undefined)     // true
```

### delete()

```
delete`æ–¹æ³•åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å›`true`ã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å›`false
const m = new Map();
m.set(undefined, 'nah');
m.has(undefined)     // true

m.delete(undefined)
m.has(undefined)       // false
```

### clear()

`clear`æ–¹æ³•æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼

```javascript
let map = new Map();
map.set('foo', true);
map.set('bar', false);

map.size // 2
map.clear()
map.size // 0
```

### éå†

`Map`ç»“æ„åŸç”Ÿæä¾›ä¸‰ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°å’Œä¸€ä¸ªéå†æ–¹æ³•ï¼š

- keys()ï¼šè¿”å›é”®åçš„éå†å™¨
- values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨
- entries()ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨
- forEach()ï¼šéå† Map çš„æ‰€æœ‰æˆå‘˜

éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº

```javascript
const map = new Map([
  ['F', 'no'],
  ['T',  'yes'],
]);

for (let key of map.keys()) {
  console.log(key);
}
// "F"
// "T"

for (let value of map.values()) {
  console.log(value);
}
// "no"
// "yes"

for (let item of map.entries()) {
  console.log(item[0], item[1]);
}
// "F" "no"
// "T" "yes"

// æˆ–è€…
for (let [key, value] of map.entries()) {
  console.log(key, value);
}
// "F" "no"
// "T" "yes"

// ç­‰åŒäºä½¿ç”¨map.entries()
for (let [key, value] of map) {
  console.log(key, value);
}
// "F" "no"
// "T" "yes"

map.forEach(function(value, key, map) {
  console.log("Key: %s, Value: %s", key, value);
});
```

## ä¸‰ã€WeakSet å’Œ WeakMap

æˆ‘ä»¬ä»å‰é¢çš„ [åƒåœ¾å›æ”¶](https://zh.javascript.info/garbage-collection) ç« èŠ‚ä¸­çŸ¥é“ï¼ŒJavaScript å¼•æ“åœ¨å€¼â€œå¯è¾¾â€å’Œå¯èƒ½è¢«ä½¿ç”¨æ—¶ä¼šå°†å…¶ä¿æŒåœ¨å†…å­˜ä¸­ã€‚

ä¾‹å¦‚ï¼š

```javascript
let john = { name: "John" };

// è¯¥å¯¹è±¡èƒ½è¢«è®¿é—®ï¼Œjohn æ˜¯å®ƒçš„å¼•ç”¨

// è¦†ç›–å¼•ç”¨
john = null;

// è¯¥å¯¹è±¡å°†ä¼šè¢«ä»å†…å­˜ä¸­æ¸…é™¤
```

é€šå¸¸ï¼Œå½“å¯¹è±¡ã€æ•°ç»„ä¹‹ç±»çš„æ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­æ—¶ï¼Œå®ƒä»¬çš„å­å…ƒç´ ï¼Œå¦‚å¯¹è±¡çš„å±æ€§ã€æ•°ç»„çš„å…ƒç´ éƒ½è¢«è®¤ä¸ºæ˜¯å¯è¾¾çš„ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæŠŠä¸€ä¸ªå¯¹è±¡æ”¾å…¥åˆ°æ•°ç»„ä¸­ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªæ•°ç»„å­˜åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¹Ÿå°±å­˜åœ¨ï¼Œå³ä½¿æ²¡æœ‰å…¶ä»–å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚

å°±åƒè¿™æ ·:

```javascript
let john = { name: "John" };

let array = [ john ];

john = null; // è¦†ç›–å¼•ç”¨

// å‰é¢ç”± john æ‰€å¼•ç”¨çš„é‚£ä¸ªå¯¹è±¡è¢«å­˜å‚¨åœ¨äº† array ä¸­
// æ‰€ä»¥å®ƒä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶
// æˆ‘ä»¬å¯ä»¥é€šè¿‡ array[0] è·å–åˆ°å®ƒ
```

ç±»ä¼¼çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¯¹è±¡ä½œä¸ºå¸¸è§„ `Map` çš„é”®ï¼Œé‚£ä¹ˆå½“ `Map` å­˜åœ¨æ—¶ï¼Œè¯¥å¯¹è±¡ä¹Ÿå°†å­˜åœ¨ã€‚å®ƒä¼šå ç”¨å†…å­˜ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰å›æ”¶ã€‚

ä¾‹å¦‚ï¼š

```javascript
let john = { name: "John" };

let map = new Map();
map.set(john, "...");

john = null; // è¦†ç›–å¼•ç”¨

// john è¢«å­˜å‚¨åœ¨äº† map ä¸­ï¼Œ
// æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ map.keys() æ¥è·å–å®ƒ
```

`WeakMap` åœ¨è¿™æ–¹é¢æœ‰ç€æ ¹æœ¬ä¸Šçš„ä¸åŒã€‚å®ƒä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶æœºåˆ¶å¯¹ä½œä¸ºé”®çš„å¯¹è±¡ï¼ˆkey objectï¼‰çš„å›æ”¶ã€‚

è®©æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥çœ‹çœ‹è¿™æŒ‡çš„åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

### [WeakMap](https://zh.javascript.info/weakmap-weakset#weakmap)

`WeakMap` å’Œ `Map` çš„ç¬¬ä¸€ä¸ªä¸åŒç‚¹å°±æ˜¯ï¼Œ`WeakMap` çš„é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ˜¯åŸå§‹å€¼ï¼š

```javascript
let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "ok"); // æ­£å¸¸å·¥ä½œï¼ˆä»¥å¯¹è±¡ä½œä¸ºé”®ï¼‰

// ä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®
weakMap.set("test", "Whoops"); // Errorï¼Œå› ä¸º "test" ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ weakMap ä¸­ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ä½œä¸ºé”®ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ â€”â€” è¯¥å¯¹è±¡å°†ä¼šè¢«ä»å†…å­˜ï¼ˆå’Œmapï¼‰ä¸­è‡ªåŠ¨æ¸…é™¤ã€‚

```javascript
let john = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // è¦†ç›–å¼•ç”¨

// john è¢«ä»å†…å­˜ä¸­åˆ é™¤äº†ï¼
```

ä¸ä¸Šé¢å¸¸è§„çš„ `Map` çš„ä¾‹å­ç›¸æ¯”ï¼Œç°åœ¨å¦‚æœ `john` ä»…ä»…æ˜¯ä½œä¸º `WeakMap` çš„é”®è€Œå­˜åœ¨ â€”â€” å®ƒå°†ä¼šè¢«ä» mapï¼ˆå’Œå†…å­˜ï¼‰ä¸­è‡ªåŠ¨åˆ é™¤ã€‚

`WeakMap` ä¸æ”¯æŒè¿­ä»£ä»¥åŠ `keys()`ï¼Œ`values()` å’Œ `entries()` æ–¹æ³•ã€‚æ‰€ä»¥æ²¡æœ‰åŠæ³•è·å– `WeakMap` çš„æ‰€æœ‰é”®æˆ–å€¼ã€‚

`WeakMap` åªæœ‰ä»¥ä¸‹çš„æ–¹æ³•ï¼š

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§é™åˆ¶å‘¢ï¼Ÿè¿™æ˜¯æŠ€æœ¯çš„åŸå› ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸¢å¤±äº†å…¶å®ƒæ‰€æœ‰å¼•ç”¨ï¼ˆå°±åƒä¸Šé¢ç¤ºä¾‹ä¸­çš„ `john`ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨å›æ”¶ã€‚ä½†æ˜¯åœ¨ä»æŠ€æœ¯çš„è§’åº¦å¹¶ä¸èƒ½å‡†ç¡®çŸ¥é“ **ä½•æ—¶ä¼šè¢«å›æ”¶**ã€‚

è¿™äº›éƒ½æ˜¯ç”± JavaScript å¼•æ“å†³å®šçš„ã€‚JavaScript å¼•æ“å¯èƒ½ä¼šé€‰æ‹©ç«‹å³æ‰§è¡Œå†…å­˜æ¸…ç†ï¼Œå¦‚æœç°åœ¨æ­£åœ¨å‘ç”Ÿå¾ˆå¤šåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆ JavaScript å¼•æ“å¯èƒ½å°±ä¼šé€‰æ‹©ç­‰ä¸€ç­‰ï¼Œç¨åå†è¿›è¡Œå†…å­˜æ¸…ç†ã€‚å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œ`WeakMap` çš„å½“å‰å…ƒç´ çš„æ•°é‡æ˜¯æœªçŸ¥çš„ã€‚JavaScript å¼•æ“å¯èƒ½æ¸…ç†äº†å…¶ä¸­çš„åƒåœ¾ï¼Œå¯èƒ½æ²¡æ¸…ç†ï¼Œä¹Ÿå¯èƒ½æ¸…ç†äº†ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæš‚ä¸æ”¯æŒè®¿é—® `WeakMap` çš„æ‰€æœ‰é”®/å€¼çš„æ–¹æ³•ã€‚

é‚£ä¹ˆï¼Œåœ¨å“ªé‡Œæˆ‘ä»¬ä¼šéœ€è¦è¿™æ ·çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ

### [ä½¿ç”¨æ¡ˆä¾‹ï¼šé¢å¤–çš„æ•°æ®](https://zh.javascript.info/weakmap-weakset#shi-yong-an-li-ewai-de-shu-ju)

`WeakMap` çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ **é¢å¤–æ•°æ®çš„å­˜å‚¨**ã€‚

å‡å¦‚æˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªâ€œå±äºâ€å¦ä¸€ä¸ªä»£ç çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶æƒ³å­˜å‚¨ä¸€äº›ä¸ä¹‹ç›¸å…³çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å°±åº”è¯¥ä¸è¿™ä¸ªå¯¹è±¡å…±å­˜äº¡ â€”â€” è¿™æ—¶å€™ `WeakMap` æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„åˆ©å™¨ã€‚

æˆ‘ä»¬å°†è¿™äº›æ•°æ®æ”¾åˆ° `WeakMap` ä¸­ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡ä½œä¸ºè¿™äº›æ•°æ®çš„é”®ï¼Œé‚£ä¹ˆå½“è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶åï¼Œè¿™äº›æ•°æ®ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚

```javascript
weakMap.set(john, "secret documents");
// å¦‚æœ john æ¶ˆå¤±ï¼Œsecret documents å°†ä¼šè¢«è‡ªåŠ¨æ¸…é™¤
```

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ç”¨äºå¤„ç†ç”¨æˆ·è®¿é—®è®¡æ•°çš„ä»£ç ã€‚æ”¶é›†åˆ°çš„ä¿¡æ¯è¢«å­˜å‚¨åœ¨ map ä¸­ï¼šä¸€ä¸ªç”¨æˆ·å¯¹è±¡ä½œä¸ºé”®ï¼Œå…¶è®¿é—®æ¬¡æ•°ä¸ºå€¼ã€‚å½“ä¸€ä¸ªç”¨æˆ·ç¦»å¼€æ—¶ï¼ˆè¯¥ç”¨æˆ·å¯¹è±¡å°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼‰ï¼Œè¿™æ—¶æˆ‘ä»¬å°±ä¸å†éœ€è¦ä»–çš„è®¿é—®æ¬¡æ•°äº†ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ `Map` çš„è®¡æ•°å‡½æ•°çš„ä¾‹å­ï¼š

```javascript
// ğŸ“ visitsCount.js
let visitsCountMap = new Map(); // map: user => visits count

// é€’å¢ç”¨æˆ·æ¥è®¿æ¬¡æ•°
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

ä¸‹é¢æ˜¯å…¶ä»–éƒ¨åˆ†çš„ä»£ç ï¼Œå¯èƒ½æ˜¯ä½¿ç”¨å®ƒçš„å…¶å®ƒä»£ç ï¼š

```javascript
// ğŸ“ main.js
let john = { name: "John" };

countUser(john); // count his visits

// ä¸ä¹…ä¹‹åï¼Œjohn ç¦»å¼€äº†
john = null;
```

ç°åœ¨ï¼Œ`john` è¿™ä¸ªå¯¹è±¡åº”è¯¥è¢«åƒåœ¾å›æ”¶ï¼Œä½†å®ƒä»åœ¨å†…å­˜ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯ `visitsCountMap` ä¸­çš„ä¸€ä¸ªé”®ã€‚

å½“æˆ‘ä»¬ç§»é™¤ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ¸…ç† `visitsCountMap`ï¼Œå¦åˆ™å®ƒå°†åœ¨å†…å­˜ä¸­æ— é™å¢å¤§ã€‚åœ¨å¤æ‚çš„æ¶æ„ä¸­ï¼Œè¿™ç§æ¸…ç†ä¼šæˆä¸ºä¸€é¡¹ç¹é‡çš„ä»»åŠ¡ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ `WeakMap` æ¥é¿å…è¿™æ ·çš„é—®é¢˜ï¼š

```javascript
// ğŸ“ visitsCount.js
let visitsCountMap = new WeakMap(); // weakmap: user => visits count

// é€’å¢ç”¨æˆ·æ¥è®¿æ¬¡æ•°
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

ç°åœ¨æˆ‘ä»¬ä¸éœ€è¦å»æ¸…ç† `visitsCountMap` äº†ã€‚å½“ `john` å¯¹è±¡å˜æˆä¸å¯è¾¾æ—¶ï¼Œå³ä¾¿å®ƒæ˜¯ `WeakMap` é‡Œçš„ä¸€ä¸ªé”®ï¼Œå®ƒä¹Ÿä¼šè¿åŒå®ƒä½œä¸º `WeakMap` é‡Œçš„é”®æ‰€å¯¹åº”çš„ä¿¡æ¯ä¸€åŒè¢«ä»å†…å­˜ä¸­åˆ é™¤ã€‚

### [ä½¿ç”¨æ¡ˆä¾‹ï¼šç¼“å­˜](https://zh.javascript.info/weakmap-weakset#shi-yong-an-li-huan-cun)

å¦å¤–ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ç¼“å­˜ã€‚æˆ‘ä»¬å¯ä»¥å­˜å‚¨ï¼ˆâ€œç¼“å­˜â€ï¼‰å‡½æ•°çš„ç»“æœï¼Œä»¥ä¾¿å°†æ¥å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„è°ƒç”¨å¯ä»¥é‡ç”¨è¿™ä¸ªç»“æœã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Map`ï¼ˆéæœ€ä½³æ–¹æ¡ˆï¼‰ï¼š

```javascript
// ğŸ“ cache.js
let cache = new Map();

// è®¡ç®—å¹¶è®°ä½ç»“æœ
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* calculations of the result for */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// ç°åœ¨æˆ‘ä»¬åœ¨å…¶å®ƒæ–‡ä»¶ä¸­ä½¿ç”¨ process()

// ğŸ“ main.js
let obj = {/* å‡è®¾æˆ‘ä»¬æœ‰ä¸ªå¯¹è±¡ */};

let result1 = process(obj); // è®¡ç®—å®Œæˆ

// â€¦â€¦ç¨åï¼Œæ¥è‡ªä»£ç çš„å¦å¤–ä¸€ä¸ªåœ°æ–¹â€¦â€¦
let result2 = process(obj); // å–è‡ªç¼“å­˜çš„è¢«è®°å¿†çš„ç»“æœ

// â€¦â€¦ç¨åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªå¯¹è±¡æ—¶ï¼š
obj = null;

alert(cache.size); // 1ï¼ˆå•Šï¼è¯¥å¯¹è±¡ä¾ç„¶åœ¨ cache ä¸­ï¼Œå¹¶å æ®ç€å†…å­˜ï¼ï¼‰
```

å¯¹äºå¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåªéœ€åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è®¡ç®—å‡ºç»“æœï¼Œä¹‹åçš„è°ƒç”¨å¯ä»¥ç›´æ¥ä» `cache` ä¸­è·å–ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼Œå½“æˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™éœ€è¦æ¸…ç† `cache`ã€‚

å¦‚æœæˆ‘ä»¬ç”¨ `WeakMap` æ›¿ä»£ `Map`ï¼Œä¾¿ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå¯¹åº”ç¼“å­˜çš„ç»“æœä¹Ÿä¼šè¢«è‡ªåŠ¨ä»å†…å­˜ä¸­æ¸…é™¤ã€‚

```javascript
// ğŸ“ cache.js
let cache = new WeakMap();

// è®¡ç®—å¹¶è®°ç»“æœ
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* calculate the result for */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// ğŸ“ main.js
let obj = {/* some object */};

let result1 = process(obj);
let result2 = process(obj);

// â€¦â€¦ç¨åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªå¯¹è±¡æ—¶ï¼š
obj = null;

// æ— æ³•è·å– cache.sizeï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª WeakMapï¼Œ
// è¦ä¹ˆæ˜¯ 0ï¼Œæˆ–å³å°†å˜ä¸º 0
// å½“ obj è¢«åƒåœ¾å›æ”¶ï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤
```

### [WeakSet](https://zh.javascript.info/weakmap-weakset#weakset)

`WeakSet` çš„è¡¨ç°ç±»ä¼¼ï¼š

- ä¸ `Set` ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬åªèƒ½å‘ `WeakSet` æ·»åŠ å¯¹è±¡ï¼ˆè€Œä¸èƒ½æ˜¯åŸå§‹å€¼ï¼‰ã€‚
- å¯¹è±¡åªæœ‰åœ¨å…¶å®ƒæŸä¸ªï¼ˆäº›ï¼‰åœ°æ–¹èƒ½è¢«è®¿é—®çš„æ—¶å€™ï¼Œæ‰èƒ½ç•™åœ¨ `WeakSet` ä¸­ã€‚
- è·Ÿ `Set` ä¸€æ ·ï¼Œ`WeakSet` æ”¯æŒ `add`ï¼Œ`has` å’Œ `delete` æ–¹æ³•ï¼Œä½†ä¸æ”¯æŒ `size` å’Œ `keys()`ï¼Œå¹¶ä¸”ä¸å¯è¿­ä»£ã€‚

å˜â€œå¼±ï¼ˆweakï¼‰â€çš„åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä½œä¸ºé¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚ä½†å¹¶éé’ˆå¯¹ä»»æ„æ•°æ®ï¼Œè€Œæ˜¯é’ˆå¯¹â€œæ˜¯/å¦â€çš„äº‹å®ã€‚`WeakSet` çš„å…ƒç´ å¯èƒ½ä»£è¡¨ç€æœ‰å…³è¯¥å¯¹è±¡çš„æŸäº›ä¿¡æ¯ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·æ·»åŠ åˆ° `WeakSet` ä¸­ï¼Œä»¥è¿½è¸ªè®¿é—®è¿‡æˆ‘ä»¬ç½‘ç«™çš„ç”¨æˆ·ï¼š

```javascript
let visitedSet = new WeakSet();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

visitedSet.add(john); // John è®¿é—®äº†æˆ‘ä»¬
visitedSet.add(pete); // ç„¶åæ˜¯ Pete
visitedSet.add(john); // John å†æ¬¡è®¿é—®

// visitedSet ç°åœ¨æœ‰ä¸¤ä¸ªç”¨æˆ·äº†

// æ£€æŸ¥ John æ˜¯å¦æ¥è®¿è¿‡ï¼Ÿ
alert(visitedSet.has(john)); // true

// æ£€æŸ¥ Mary æ˜¯å¦æ¥è®¿è¿‡ï¼Ÿ
alert(visitedSet.has(mary)); // false

john = null;

// visitedSet å°†è¢«è‡ªåŠ¨æ¸…ç†(å³è‡ªåŠ¨æ¸…é™¤å…¶ä¸­å·²å¤±æ•ˆçš„å€¼ john)
```

`WeakMap` å’Œ `WeakSet` æœ€æ˜æ˜¾çš„å±€é™æ€§å°±æ˜¯ä¸èƒ½è¿­ä»£ï¼Œå¹¶ä¸”æ— æ³•è·å–æ‰€æœ‰å½“å‰å†…å®¹ã€‚é‚£æ ·å¯èƒ½ä¼šé€ æˆä¸ä¾¿ï¼Œä½†æ˜¯å¹¶ä¸ä¼šé˜»æ­¢ `WeakMap/WeakSet` å®Œæˆå…¶ä¸»è¦å·¥ä½œ â€”â€” ä¸ºåœ¨å…¶å®ƒåœ°æ–¹å­˜å‚¨/ç®¡ç†çš„å¯¹è±¡æ•°æ®æä¾›â€œé¢å¤–â€å­˜å‚¨ã€‚

### [æ€»ç»“](https://zh.javascript.info/weakmap-weakset#zong-jie)

`WeakMap` æ˜¯ç±»ä¼¼äº `Map` çš„é›†åˆï¼Œå®ƒä»…å…è®¸å¯¹è±¡ä½œä¸ºé”®ï¼Œå¹¶ä¸”ä¸€æ—¦é€šè¿‡å…¶ä»–æ–¹å¼æ— æ³•è®¿é—®è¿™äº›å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¾¿ä¼šå°†è¿™äº›å¯¹è±¡ä¸å…¶å…³è”å€¼ä¸€åŒåˆ é™¤ã€‚

`WeakSet` æ˜¯ç±»ä¼¼äº `Set` çš„é›†åˆï¼Œå®ƒä»…å­˜å‚¨å¯¹è±¡ï¼Œå¹¶ä¸”ä¸€æ—¦é€šè¿‡å…¶ä»–æ–¹å¼æ— æ³•è®¿é—®è¿™äº›å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¾¿ä¼šå°†è¿™äº›å¯¹è±¡åˆ é™¤ã€‚

å®ƒä»¬çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒä»¬å¯¹å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥è¢«å®ƒä»¬å¼•ç”¨çš„å¯¹è±¡å¾ˆå®¹æ˜“åœ°è¢«åƒåœ¾æ”¶é›†å™¨ç§»é™¤ã€‚

è¿™æ˜¯ä»¥ä¸æ”¯æŒ `clear`ã€`size`ã€`keys`ã€`values` ç­‰ä½œä¸ºä»£ä»·æ¢æ¥çš„â€¦â€¦

`WeakMap` å’Œ `WeakSet` è¢«ç”¨ä½œâ€œä¸»è¦â€å¯¹è±¡å­˜å‚¨ä¹‹å¤–çš„â€œè¾…åŠ©â€æ•°æ®ç»“æ„ã€‚ä¸€æ—¦å°†å¯¹è±¡ä»ä¸»å­˜å‚¨å™¨ä¸­åˆ é™¤ï¼Œå¦‚æœè¯¥å¯¹è±¡ä»…è¢«ç”¨ä½œ `WeakMap` æˆ– `WeakSet` çš„é”®ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°†è¢«è‡ªåŠ¨æ¸…é™¤ã€‚

```js
const wm = new WeakMap();
let key = {};
let obj = {foo: 1};

wm.set(key, obj);
obj = null;
wm.get(key)
// Object {foo: 1}
```







# 5. ä½ æ˜¯æ€ä¹ˆç†è§£ES6ä¸­ Generatorçš„ï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ

![img](https://static.vue-js.com/7db499b0-5947-11eb-ab90-d9ae814b240d.png)

## ä¸€ã€ä»‹ç»

Generator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒ

å›é¡¾ä¸‹ä¸Šæ–‡æåˆ°çš„è§£å†³å¼‚æ­¥çš„æ‰‹æ®µï¼š

- å›è°ƒå‡½æ•°
- promise

é‚£ä¹ˆï¼Œä¸Šæ–‡æˆ‘ä»¬æåˆ°`promsie`å·²ç»æ˜¯ä¸€ç§æ¯”è¾ƒæµè¡Œçš„è§£å†³å¼‚æ­¥æ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜å‡ºç°`Generator`ï¼Ÿç”šè‡³`async/await`å‘¢ï¼Ÿ

è¯¥é—®é¢˜æˆ‘ä»¬ç•™åœ¨åé¢å†è¿›è¡Œåˆ†æï¼Œä¸‹é¢å…ˆè®¤è¯†ä¸‹`Generator`

### Generatorå‡½æ•°

æ‰§è¡Œ `Generator` å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† `Generator` å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€

å½¢å¼ä¸Šï¼Œ`Generator`å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ï¼š

- `function`å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·
- å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨`yield`è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€

```javascript
function* helloWorldGenerator() {
  yield 'hello';
  yield 'world';
  return 'ending';
}
```

## äºŒã€ä½¿ç”¨

`Generator` å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå³å…·æœ‰`Symbol.iterator`å±æ€§ï¼Œå¹¶ä¸”è¿”å›ç»™è‡ªå·±

```javascript
function* gen(){
  // some code
}

var g = gen();

g[Symbol.iterator]() === g
// true
```

é€šè¿‡`yield`å…³é”®å­—å¯ä»¥æš‚åœ`generator`å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡çš„çŠ¶æ€

```javascript
function* helloWorldGenerator() {
  yield 'hello';
  yield 'world';
  return 'ending';
}
var hw = helloWorldGenerator();
```

ä¸Šè¿°å­˜åœ¨ä¸‰ä¸ªçŠ¶æ€ï¼š`hello`ã€`world`ã€`return`

é€šè¿‡`next`æ–¹æ³•æ‰ä¼šéå†åˆ°ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œå…¶è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š

- é‡åˆ°`yield`è¡¨è¾¾å¼ï¼Œå°±æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†ç´§è·Ÿåœ¨`yield`åé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„`value`å±æ€§å€¼ã€‚
- ä¸‹ä¸€æ¬¡è°ƒç”¨`next`æ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª`yield`è¡¨è¾¾å¼
- å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„`yield`è¡¨è¾¾å¼ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ°`return`è¯­å¥ä¸ºæ­¢ï¼Œå¹¶å°†`return`è¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„`value`å±æ€§å€¼ã€‚
- å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰`return`è¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„`value`å±æ€§å€¼ä¸º`undefined`

```javascript
hw.next()
// { value: 'hello', done: false }

hw.next()
// { value: 'world', done: false }

hw.next()
// { value: 'ending', done: true }

hw.next()
// { value: undefined, done: true }
```

`done`ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‹ä¸ªçŠ¶æ€ï¼Œ`value`å¯¹åº”çŠ¶æ€å€¼

`yield`è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å›`undefined`

é€šè¿‡è°ƒç”¨`next`æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª`yield`è¡¨è¾¾å¼çš„è¿”å›å€¼

```javascript
function* foo(x) {
  var y = 2 * (yield (x + 1));
  var z = yield (y / 3);
  return (x + y + z);
}

var a = foo(5);
a.next() // Object{value:6, done:false}
a.next() // Object{value:NaN, done:false}
a.next() // Object{value:NaN, done:true}

var b = foo(5);
b.next() // { value:6, done:false }
b.next(12) // { value:8, done:false }
b.next(13) // { value:42, done:true }
```

æ­£å› ä¸º`Generator`å‡½æ•°è¿”å›`Iterator`å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡`for...of`è¿›è¡Œéå†

```javascript
function* foo() {
  yield 1;
  yield 2;
  yield 3;
  yield 4;
  yield 5;
  return 6;
}

for (let v of foo()) {
  console.log(v);
}
// 1 2 3 4 5
```

åŸç”Ÿå¯¹è±¡æ²¡æœ‰éå†æ¥å£ï¼Œé€šè¿‡`Generator`å‡½æ•°ä¸ºå®ƒåŠ ä¸Šè¿™ä¸ªæ¥å£ï¼Œå°±èƒ½ä½¿ç”¨`for...of`è¿›è¡Œéå†äº†

```javascript
function* objectEntries(obj) {
  let propKeys = Reflect.ownKeys(obj);

  for (let propKey of propKeys) {
    yield [propKey, obj[propKey]];
  }
}

let jane = { first: 'Jane', last: 'Doe' };

for (let [key, value] of objectEntries(jane)) {
  console.log(`${key}: ${value}`);
}
// first: Jane
// last: Doe
```

## ä¸‰ã€å¼‚æ­¥è§£å†³æ–¹æ¡ˆ

å›é¡¾ä¹‹å‰å±•å¼€å¼‚æ­¥è§£å†³çš„æ–¹æ¡ˆï¼š

- å›è°ƒå‡½æ•°
- Promise å¯¹è±¡
- generator å‡½æ•°
- async/await

è¿™é‡Œé€šè¿‡æ–‡ä»¶è¯»å–æ¡ˆä¾‹ï¼Œå°†å‡ ç§è§£å†³å¼‚æ­¥çš„æ–¹æ¡ˆè¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼š

### å›è°ƒå‡½æ•°

æ‰€è°“å›è°ƒå‡½æ•°ï¼Œå°±æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç­‰åˆ°é‡æ–°æ‰§è¡Œè¿™ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå†è°ƒç”¨è¿™ä¸ªå‡½æ•°

```javascript
fs.readFile('/etc/fstab', function (err, data) {
  if (err) throw err;
  console.log(data);
  fs.readFile('/etc/shells', function (err, data) {
    if (err) throw err;
    console.log(data);
  });
});
```

`readFile`å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°±æ˜¯å›è°ƒå‡½æ•°ï¼Œç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›äº†`/etc/passwd`è¿™ä¸ªæ–‡ä»¶ä»¥åï¼Œå›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œ

### Promise

`Promise`å°±æ˜¯ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±è€Œäº§ç”Ÿçš„ï¼Œå°†å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œæ”¹æˆé“¾å¼è°ƒç”¨

```js
const fs = require('fs');

const readFile = function (fileName) {
  return new Promise(function (resolve, reject) {
    fs.readFile(fileName, function(error, data) {
      if (error) return reject(error);
      resolve(data);
    });
  });
};


readFile('/etc/fstab').then(data =>{
    console.log(data)
    return readFile('/etc/shells')
}).then(data => {
    console.log(data)
})
```

è¿™ç§é“¾å¼æ“ä½œå½¢å¼ï¼Œä½¿å¼‚æ­¥ä»»åŠ¡çš„ä¸¤æ®µæ‰§è¡Œæ›´æ¸…æ¥šäº†ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨äº†å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œä»£ç å˜å¾—å†—æ‚äº†ï¼Œè¯­ä¹‰åŒ–å¹¶ä¸å¼º

### generator

`yield`è¡¨è¾¾å¼å¯ä»¥æš‚åœå‡½æ•°æ‰§è¡Œï¼Œ`next`æ–¹æ³•ç”¨äºæ¢å¤å‡½æ•°æ‰§è¡Œï¼Œè¿™ä½¿å¾—`Generator`å‡½æ•°éå¸¸é€‚åˆå°†å¼‚æ­¥ä»»åŠ¡åŒæ­¥åŒ–

```javascript
const gen = function* () {
  const f1 = yield readFile('/etc/fstab');
  const f2 = yield readFile('/etc/shells');
  console.log(f1.toString());
  console.log(f2.toString());
};
```

### async/await

å°†ä¸Šé¢`Generator`å‡½æ•°æ”¹æˆ`async/await`å½¢å¼ï¼Œæ›´ä¸ºç®€æ´ï¼Œè¯­ä¹‰åŒ–æ›´å¼ºäº†

```js
const asyncReadFile = async function () {
  const f1 = await readFile('/etc/fstab');
  const f2 = await readFile('/etc/shells');
  console.log(f1.toString());
  console.log(f2.toString());
};
```

### åŒºåˆ«ï¼š

é€šè¿‡ä¸Šè¿°ä»£ç è¿›è¡Œåˆ†æï¼Œå°†`promise`ã€`Generator`ã€`async/await`è¿›è¡Œæ¯”è¾ƒï¼š

- `promise`å’Œ`async/await`æ˜¯ä¸“é—¨ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„
- `Generator`å¹¶ä¸æ˜¯ä¸ºå¼‚æ­¥è€Œè®¾è®¡å‡ºæ¥çš„ï¼Œå®ƒè¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼ˆå¯¹è±¡è¿­ä»£ã€æ§åˆ¶è¾“å‡ºã€éƒ¨ç½²`Interator`æ¥å£...ï¼‰
- `promise`ç¼–å†™ä»£ç ç›¸æ¯”`Generator`ã€`async`æ›´ä¸ºå¤æ‚åŒ–ï¼Œä¸”å¯è¯»æ€§ä¹Ÿç¨å·®
- `Generator`ã€`async`éœ€è¦ä¸`promise`å¯¹è±¡æ­é…å¤„ç†å¼‚æ­¥æƒ…å†µ
- `async`å®è´¨æ˜¯`Generator`çš„è¯­æ³•ç³–ï¼Œç›¸å½“äºä¼šè‡ªåŠ¨æ‰§è¡Œ`Generator`å‡½æ•°
- `async`ä½¿ç”¨ä¸Šæ›´ä¸ºç®€æ´ï¼Œå°†å¼‚æ­¥ä»£ç ä»¥åŒæ­¥çš„å½¢å¼è¿›è¡Œç¼–å†™ï¼Œæ˜¯å¤„ç†å¼‚æ­¥ç¼–ç¨‹çš„æœ€ç»ˆæ–¹æ¡ˆ

## å››ã€ä½¿ç”¨åœºæ™¯

`Generator`æ˜¯å¼‚æ­¥è§£å†³çš„ä¸€ç§æ–¹æ¡ˆï¼Œæœ€å¤§ç‰¹ç‚¹åˆ™æ˜¯å°†å¼‚æ­¥æ“ä½œåŒæ­¥åŒ–è¡¨è¾¾å‡ºæ¥

```js
function* loadUI() {
  showLoadingScreen();
  yield loadUIDataAsynchronously();
  hideLoadingScreen();
}
var loader = loadUI();
// åŠ è½½UI
loader.next()

// å¸è½½UI
loader.next()
```

åŒ…æ‹¬`redux-saga`ä¸­é—´ä»¶ä¹Ÿå……åˆ†åˆ©ç”¨äº†`Generator`ç‰¹æ€§

```js
import { call, put, takeEvery, takeLatest } from 'redux-saga/effects'
import Api from '...'

function* fetchUser(action) {
   try {
      const user = yield call(Api.fetchUser, action.payload.userId);
      yield put({type: "USER_FETCH_SUCCEEDED", user: user});
   } catch (e) {
      yield put({type: "USER_FETCH_FAILED", message: e.message});
   }
}

function* mySaga() {
  yield takeEvery("USER_FETCH_REQUESTED", fetchUser);
}

function* mySaga() {
  yield takeLatest("USER_FETCH_REQUESTED", fetchUser);
}

export default mySaga;
```

è¿˜èƒ½åˆ©ç”¨`Generator`å‡½æ•°ï¼Œåœ¨å¯¹è±¡ä¸Šå®ç°`Iterator`æ¥å£

```js
function* iterEntries(obj) {
  let keys = Object.keys(obj);
  for (let i=0; i < keys.length; i++) {
    let key = keys[i];
    yield [key, obj[key]];
  }
}

let myObj = { foo: 3, bar: 7 };

for (let [key, value] of iterEntries(myObj)) {
  console.log(key, value);
}

// foo 3
// bar 7
```





# 6. ä½ æ˜¯æ€ä¹ˆç†è§£ES6ä¸­Proxyçš„ï¼Ÿä½¿ç”¨åœºæ™¯?

![img](https://static.vue-js.com/6f656e30-59f5-11eb-85f6-6fac77c0c9b3.png)

## ä¸€ã€ä»‹ç»

**å®šä¹‰ï¼š** ç”¨äºå®šä¹‰åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸º

**æœ¬è´¨ï¼š** ä¿®æ”¹çš„æ˜¯ç¨‹åºé»˜è®¤å½¢ä¸ºï¼Œå°±å½¢åŒäºåœ¨ç¼–ç¨‹è¯­è¨€å±‚é¢ä¸Šåšä¿®æ”¹ï¼Œå±äºå…ƒç¼–ç¨‹`(meta programming)`

å…ƒç¼–ç¨‹ï¼ˆMetaprogrammingï¼Œåˆè¯‘è¶…ç¼–ç¨‹ï¼Œæ˜¯æŒ‡æŸç±»è®¡ç®—æœºç¨‹åºçš„ç¼–å†™ï¼Œè¿™ç±»è®¡ç®—æœºç¨‹åºç¼–å†™æˆ–è€…æ“çºµå…¶å®ƒç¨‹åºï¼ˆæˆ–è€…è‡ªèº«ï¼‰ä½œä¸ºå®ƒä»¬çš„æ•°æ®ï¼Œæˆ–è€…åœ¨è¿è¡Œæ—¶å®Œæˆéƒ¨åˆ†æœ¬åº”åœ¨ç¼–è¯‘æ—¶å®Œæˆçš„å·¥ä½œ

ä¸€æ®µä»£ç æ¥ç†è§£

```bash
#!/bin/bash
# metaprogram
echo '#!/bin/bash' >program
for ((I=1; I<=1024; I++)) do
    echo "echo $I" >>program
done
chmod +x program
```

è¿™æ®µç¨‹åºæ¯æ‰§è¡Œä¸€æ¬¡èƒ½å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåä¸º`program`çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸º1024è¡Œ`echo`ï¼Œå¦‚æœæˆ‘ä»¬æ‰‹åŠ¨æ¥å†™1024è¡Œä»£ç ï¼Œæ•ˆç‡æ˜¾ç„¶ä½æ•ˆ

- å…ƒç¼–ç¨‹ä¼˜ç‚¹ï¼šä¸æ‰‹å·¥ç¼–å†™å…¨éƒ¨ä»£ç ç›¸æ¯”ï¼Œç¨‹åºå‘˜å¯ä»¥è·å¾—æ›´é«˜çš„å·¥ä½œæ•ˆç‡ï¼Œæˆ–è€…ç»™ä¸ç¨‹åºæ›´å¤§çš„çµæ´»åº¦å»å¤„ç†æ–°çš„æƒ…å½¢è€Œæ— éœ€é‡æ–°ç¼–è¯‘

`Proxy` äº¦æ˜¯å¦‚æ­¤ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰

## äºŒã€ç”¨æ³•

`Proxy`ä¸º æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ `Proxy`å®ä¾‹

```javascript
var proxy = new Proxy(target, handler)
```

### å‚æ•°

`target`è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼ˆä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ï¼‰

`handler`é€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œå„å±æ€§ä¸­çš„å‡½æ•°åˆ†åˆ«å®šä¹‰äº†åœ¨æ‰§è¡Œå„ç§æ“ä½œæ—¶ä»£ç† `p` çš„è¡Œä¸º

### handlerè§£æ

å…³äº`handler`æ‹¦æˆªå±æ€§ï¼Œæœ‰å¦‚ä¸‹ï¼š

- get(target,propKey,receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–
- set(target,propKey,value,receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®
- has(target,propKey)ï¼šæ‹¦æˆª`propKey in proxy`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- deleteProperty(target,propKey)ï¼šæ‹¦æˆª`delete proxy[propKey]`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- ownKeys(target)ï¼šæ‹¦æˆª`Object.keys(proxy)`ã€`for...in`ç­‰å¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„
- getOwnPropertyDescriptor(target, propKey)ï¼šæ‹¦æˆª`Object.getOwnPropertyDescriptor(proxy, propKey)`ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡
- defineProperty(target, propKey, propDesc)ï¼šæ‹¦æˆª`Object.defineProperty(proxy, propKey, propDescï¼‰`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- preventExtensions(target)ï¼šæ‹¦æˆª`Object.preventExtensions(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- getPrototypeOf(target)ï¼šæ‹¦æˆª`Object.getPrototypeOf(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡
- isExtensible(target)ï¼šæ‹¦æˆª`Object.isExtensible(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- setPrototypeOf(target, proto)ï¼šæ‹¦æˆª`Object.setPrototypeOf(proxy, proto)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- apply(target, object, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œ
- construct(target, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œ

### Reflect

è‹¥éœ€è¦åœ¨`Proxy`å†…éƒ¨è°ƒç”¨å¯¹è±¡çš„é»˜è®¤è¡Œä¸ºï¼Œå»ºè®®ä½¿ç”¨`Reflect`ï¼Œå…¶æ˜¯`ES6`ä¸­æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° `API`

åŸºæœ¬ç‰¹ç‚¹ï¼š

- åªè¦`Proxy`å¯¹è±¡å…·æœ‰çš„ä»£ç†æ–¹æ³•ï¼Œ`Reflect`å¯¹è±¡å…¨éƒ¨å…·æœ‰ï¼Œä»¥é™æ€æ–¹æ³•çš„å½¢å¼å­˜åœ¨
- ä¿®æ”¹æŸäº›`Object`æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ï¼ˆå®šä¹‰ä¸å­˜åœ¨å±æ€§è¡Œä¸ºçš„æ—¶å€™ä¸æŠ¥é”™è€Œæ˜¯è¿”å›`false`ï¼‰
- è®©`Object`æ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º

ä¸‹é¢æˆ‘ä»¬ä»‹ç»`proxy`å‡ ç§ç”¨æ³•ï¼š

### get()

`get`æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åå’Œ `proxy` å®ä¾‹æœ¬èº«ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¯é€‰

```javascript
var person = {
  name: "å¼ ä¸‰"
};

var proxy = new Proxy(person, {
  get: function(target, propKey) {
    return Reflect.get(target,propKey)
  }
});

proxy.name // "å¼ ä¸‰"
```

`get`èƒ½å¤Ÿå¯¹æ•°ç»„å¢åˆ æ”¹æŸ¥è¿›è¡Œæ‹¦æˆªï¼Œä¸‹é¢æ˜¯è¯•ä¸‹ä½ æ•°ç»„è¯»å–è´Ÿæ•°çš„ç´¢å¼•

```js
function createArray(...elements) {
  let handler = {
    get(target, propKey, receiver) {
      let index = Number(propKey);
      if (index < 0) {
        propKey = String(target.length + index);
      }
      return Reflect.get(target, propKey, receiver);
    }
  };

  let target = [];
  target.push(...elements);
  return new Proxy(target, handler);
}

let arr = createArray('a', 'b', 'c');
arr[-1] // c
```

æ³¨æ„ï¼šå¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ä¸”ä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™ Proxy ä¸èƒ½ä¿®æ”¹è¯¥å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```js
const target = Object.defineProperties({}, {
  foo: {
    value: 123,
    writable: false,
    configurable: false
  },
});

const handler = {
  get(target, propKey) {
    return 'abc';
  }
};

const proxy = new Proxy(target, handler);

proxy.foo
// TypeError: Invariant check failed
```

### set()

`set`æ–¹æ³•ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œï¼Œå¯ä»¥æ¥å—å››ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åã€å±æ€§å€¼å’Œ `Proxy` å®ä¾‹æœ¬èº«

å‡å®š`Person`å¯¹è±¡æœ‰ä¸€ä¸ª`age`å±æ€§ï¼Œè¯¥å±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªä¸å¤§äº 200 çš„æ•´æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨`Proxy`ä¿è¯`age`çš„å±æ€§å€¼ç¬¦åˆè¦æ±‚

```js
let validator = {
  set: function(obj, prop, value) {
    if (prop === 'age') {
      if (!Number.isInteger(value)) {
        throw new TypeError('The age is not an integer');
      }
      if (value > 200) {
        throw new RangeError('The age seems invalid');
      }
    }

    // å¯¹äºæ»¡è¶³æ¡ä»¶çš„ age å±æ€§ä»¥åŠå…¶ä»–å±æ€§ï¼Œç›´æ¥ä¿å­˜
    obj[prop] = value;
  }
};

let person = new Proxy({}, validator);

person.age = 100;

person.age // 100
person.age = 'young' // æŠ¥é”™
person.age = 300 // æŠ¥é”™
```

å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ï¼Œä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œé‚£ä¹ˆ`set`æ–¹æ³•å°†ä¸èµ·ä½œç”¨

```javascript
const obj = {};
Object.defineProperty(obj, 'foo', {
  value: 'bar',
  writable: false,
});

const handler = {
  set: function(obj, prop, value, receiver) {
    obj[prop] = 'baz';
  }
};

const proxy = new Proxy(obj, handler);
proxy.foo = 'baz';
proxy.foo // "bar"
```

æ³¨æ„ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ`set`ä»£ç†å¦‚æœæ²¡æœ‰è¿”å›`true`ï¼Œå°±ä¼šæŠ¥é”™

```javascript
'use strict';
const handler = {
  set: function(obj, prop, value, receiver) {
    obj[prop] = receiver;
    // æ— è®ºæœ‰æ²¡æœ‰ä¸‹é¢è¿™ä¸€è¡Œï¼Œéƒ½ä¼šæŠ¥é”™
    return false;
  }
};
const proxy = new Proxy({}, handler);
proxy.foo = 'bar';
// TypeError: 'set' on proxy: trap returned falsish for property 'foo'
```

### deleteProperty()

`deleteProperty`æ–¹æ³•ç”¨äºæ‹¦æˆª`delete`æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å›`false`ï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢«`delete`å‘½ä»¤åˆ é™¤

```javascript
var handler = {
  deleteProperty (target, key) {
    invariant(key, 'delete');
    Reflect.deleteProperty(target,key)
    return true;
  }
};
function invariant (key, action) {
  if (key[0] === '_') {
    throw new Error(`æ— æ³•åˆ é™¤ç§æœ‰å±æ€§`);
  }
}

var target = { _prop: 'foo' };
var proxy = new Proxy(target, handler);
delete proxy._prop
// Error: æ— æ³•åˆ é™¤ç§æœ‰å±æ€§
```

æ³¨æ„ï¼Œç›®æ ‡å¯¹è±¡è‡ªèº«çš„ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰çš„å±æ€§ï¼Œä¸èƒ½è¢«`deleteProperty`æ–¹æ³•åˆ é™¤ï¼Œå¦åˆ™æŠ¥é”™

### å–æ¶ˆä»£ç†

```text
Proxy.revocable(target, handler);
```

## ä¸‰ã€ä½¿ç”¨åœºæ™¯

`Proxy`å…¶åŠŸèƒ½éå¸¸ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ï¼Œå¸¸ç”¨åŠŸèƒ½å¦‚ä¸‹ï¼š

- æ‹¦æˆªå’Œç›‘è§†å¤–éƒ¨å¯¹å¯¹è±¡çš„è®¿é—®
- é™ä½å‡½æ•°æˆ–ç±»çš„å¤æ‚åº¦
- åœ¨å¤æ‚æ“ä½œå‰å¯¹æ“ä½œè¿›è¡Œæ ¡éªŒæˆ–å¯¹æ‰€éœ€èµ„æºè¿›è¡Œç®¡ç†

ä½¿ç”¨ `Proxy` ä¿éšœæ•°æ®ç±»å‹çš„å‡†ç¡®æ€§

```js
let numericDataStore = { count: 0, amount: 1234, total: 14 };
numericDataStore = new Proxy(numericDataStore, {
    set(target, key, value, proxy) {
        if (typeof value !== 'number') {
            throw Error("å±æ€§åªèƒ½æ˜¯numberç±»å‹");
        }
        return Reflect.set(target, key, value, proxy);
    }
});

numericDataStore.count = "foo"
// Error: å±æ€§åªèƒ½æ˜¯numberç±»å‹

numericDataStore.count = 333
// èµ‹å€¼æˆåŠŸ
```

å£°æ˜äº†ä¸€ä¸ªç§æœ‰çš„ `apiKey`ï¼Œä¾¿äº `api` è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œä½†ä¸å¸Œæœ›ä»å¤–éƒ¨ä¹Ÿèƒ½å¤Ÿè®¿é—® `api._apiKey`

```js
let api = {
    _apiKey: '123abc456def',
    getUsers: function(){ },
    getUser: function(userId){ },
    setUser: function(userId, config){ }
};
const RESTRICTED = ['_apiKey'];
api = new Proxy(api, {
    get(target, key, proxy) {
        if(RESTRICTED.indexOf(key) > -1) {
            throw Error(`${key} ä¸å¯è®¿é—®.`);
        } return Reflect.get(target, key, proxy);
    },
    set(target, key, value, proxy) {
        if(RESTRICTED.indexOf(key) > -1) {
            throw Error(`${key} ä¸å¯ä¿®æ”¹`);
        } return Reflect.get(target, key, value, proxy);
    }
});

console.log(api._apiKey)
api._apiKey = '987654321'
// ä¸Šè¿°éƒ½æŠ›å‡ºé”™è¯¯
```

è¿˜èƒ½é€šè¿‡ä½¿ç”¨`Proxy`å®ç°è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver modeï¼‰æŒ‡çš„æ˜¯å‡½æ•°è‡ªåŠ¨è§‚å¯Ÿæ•°æ®å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡æœ‰å˜åŒ–ï¼Œå‡½æ•°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ

`observable`å‡½æ•°è¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡çš„ `Proxy` ä»£ç†ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œï¼Œè§¦å‘å……å½“è§‚å¯Ÿè€…çš„å„ä¸ªå‡½æ•°

```javascript
const queuedObservers = new Set();

const observe = fn => queuedObservers.add(fn);
const observable = obj => new Proxy(obj, {set});

function set(target, key, value, receiver) {
  const result = Reflect.set(target, key, value, receiver);
  queuedObservers.forEach(observer => observer());
  return result;
}
```

è§‚å¯Ÿè€…å‡½æ•°éƒ½æ”¾è¿›`Set`é›†åˆï¼Œå½“ä¿®æ”¹`obj`çš„å€¼ï¼Œåœ¨ä¼š`set`å‡½æ•°ä¸­æ‹¦æˆªï¼Œè‡ªåŠ¨æ‰§è¡Œ`Set`æ‰€æœ‰çš„è§‚å¯Ÿè€…



# 7. ä½ æ˜¯æ€ä¹ˆç†è§£javascriptä¸­Moduleçš„ï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ

## CommonJs

`CommonJS` æ˜¯ä¸€å¥— `Javascript` æ¨¡å—è§„èŒƒï¼Œç”¨äºæœåŠ¡ç«¯

```js
// a.js
module.exports={ foo , bar}

// b.js
const { foo,bar } = require('./a.js')
```

å…¶æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ
- æ¨¡å—æ˜¯åŒæ­¥åŠ è½½çš„ï¼Œå³åªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œ
- æ¨¡å—åœ¨é¦–æ¬¡æ‰§è¡Œåå°±ä¼šç¼“å­˜ï¼Œå†æ¬¡åŠ è½½åªè¿”å›ç¼“å­˜ç»“æœï¼Œå¦‚æœæƒ³è¦å†æ¬¡æ‰§è¡Œï¼Œå¯æ¸…é™¤ç¼“å­˜
- `require`è¿”å›çš„å€¼æ˜¯è¢«è¾“å‡ºçš„å€¼çš„æ‹·è´ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–ä¹Ÿä¸ä¼šå½±å“è¿™ä¸ªå€¼



Node.js ä¸­æ ¹æ®æ¨¡å—æ¥æºçš„ä¸åŒï¼Œå°†æ¨¡å—åˆ†ä¸ºäº† 3 å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š 

* å†…ç½®æ¨¡å—ï¼ˆå†…ç½®æ¨¡å—æ˜¯ç”± Node.js å®˜æ–¹æä¾›çš„ï¼Œä¾‹å¦‚ fsã€pathã€http ç­‰ï¼‰
* è‡ªå®šä¹‰æ¨¡å—ï¼ˆç”¨æˆ·åˆ›å»ºçš„æ¯ä¸ª .js æ–‡ä»¶ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰æ¨¡å—ï¼‰ 
* ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆç”±ç¬¬ä¸‰æ–¹å¼€å‘å‡ºæ¥çš„æ¨¡å—ï¼Œå¹¶éå®˜æ–¹æä¾›çš„å†…ç½®æ¨¡å—ï¼Œä¹Ÿä¸æ˜¯ç”¨æˆ·åˆ›å»ºçš„è‡ªå®šä¹‰æ¨¡å—ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆä¸‹è½½ï¼‰



### åŠ è½½æ¨¡å—

> CommonJSçš„åŠ è½½æ–¹æ³•

ä½¿ç”¨å¼ºå¤§çš„ require() æ–¹æ³•ï¼Œå¯ä»¥åŠ è½½éœ€è¦çš„å†…ç½®æ¨¡å—ã€ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—ã€ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡Œä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š


![è¯·æ·»åŠ å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/a67358f77de24a19ba0a6f0658a44b2d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)



> æ³¨æ„ï¼šä½¿ç”¨ require() æ–¹æ³•åŠ è½½å…¶å®ƒæ¨¡å—æ—¶ï¼Œä¼šæ‰§è¡Œè¢«åŠ è½½æ¨¡å—ä¸­çš„ä»£ç ã€‚





### æ¨¡å—ä½œç”¨åŸŸ

å’Œå‡½æ•°ä½œç”¨åŸŸç±»ä¼¼ï¼Œåœ¨è‡ªå®šä¹‰æ¨¡å—ä¸­å®šä¹‰çš„å˜é‡ã€æ–¹æ³•ç­‰æˆå‘˜ï¼Œåªèƒ½åœ¨å½“å‰æ¨¡å—å†…è¢«è®¿é—®ï¼Œè¿™ç§æ¨¡å—çº§åˆ«çš„è®¿é—®é™åˆ¶ï¼Œå«åšæ¨¡å— ä½œç”¨åŸŸã€‚

![è¯·æ·»åŠ å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/4503f023adf140d694ba9b2666324cc9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)




**å¥½å¤„ï¼š**

é˜²æ­¢äº†å…¨å±€å˜é‡æ±¡æŸ“çš„é—®é¢˜





### moduleå’Œmodule.exports

moduleæ¨¡å—å­˜å‚¨äº†å’Œå½“å‰æ¨¡å—æœ‰å…³çš„ä¿¡æ¯


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6dd5f0223dea435c9f75d411a010520e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)



**module.exports**

åœ¨è‡ªå®šä¹‰æ¨¡å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ module.exports å¯¹è±¡ï¼Œå°†æ¨¡å—å†…çš„æˆå‘˜å…±äº«å‡ºå»ï¼Œä¾›å¤–ç•Œä½¿ç”¨ã€‚ 

å¤–ç•Œç”¨ require() æ–¹æ³•å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¾—åˆ°çš„å°±æ˜¯ module.exports æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚



> ä½¿ç”¨ require() æ–¹æ³•å¯¼å…¥æ¨¡å—æ—¶ï¼Œå¯¼å…¥çš„ç»“æœï¼Œæ°¸è¿œä»¥ module.exports æŒ‡å‘çš„å¯¹è±¡ä¸ºå‡†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/c08106f05aa044a38397bee668e44710.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)






ç”±äº module.exports å•è¯å†™èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†ç®€åŒ–å‘å¤–å…±äº«æˆå‘˜çš„ä»£ç ï¼ŒNode æä¾›äº† exports å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µ ä¸‹ï¼Œexports å’Œ module.exports æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚æœ€ç»ˆå…±äº«çš„ç»“æœï¼Œè¿˜æ˜¯ä»¥ module.exports æŒ‡å‘çš„å¯¹è±¡ä¸ºå‡†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/645064e0aae24e9d9f6c62df44bdcc58.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)





exports å’Œ module.exports çš„ä½¿ç”¨è¯¯åŒº

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/ceac321aba184829b820bbb25be0a38d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)


> æ³¨æ„ï¼šä¸ºäº†é˜²æ­¢æ··ä¹±ï¼Œå»ºè®®å¤§å®¶ä¸è¦åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­åŒæ—¶ä½¿ç”¨ exports å’Œ module.exports





### node.jsä¸­çš„æ¨¡å—åŒ–è§„èŒƒ

Node.js éµå¾ªäº† CommonJS æ¨¡å—åŒ–è§„èŒƒï¼ŒCommonJS è§„å®šäº†æ¨¡å—çš„ç‰¹æ€§å’Œå„æ¨¡å—ä¹‹é—´å¦‚ä½•ç›¸äº’ä¾èµ–ã€‚

CommonJS è§„å®šï¼š 

â‘  æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œmodule å˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚ 

â‘¡ module å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ exports å±æ€§ï¼ˆå³ module.exportsï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚ 

â‘¢ åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®æ˜¯åŠ è½½è¯¥æ¨¡å—çš„ module.exports å±æ€§ã€‚require() æ–¹æ³•ç”¨äºåŠ è½½æ¨¡å—ã€‚





### npmä¸åŒ…

Node.js ä¸­çš„ç¬¬ä¸‰æ–¹æ¨¡å—åˆå«åšåŒ…ã€‚

ç”±äº Node.js çš„å†…ç½®æ¨¡å—ä»…æä¾›äº†ä¸€äº›åº•å±‚çš„ APIï¼Œå¯¼è‡´åœ¨åŸºäºå†…ç½®æ¨¡å—è¿›è¡Œé¡¹ç›®å¼€å‘çš„æ—¶ï¼Œæ•ˆç‡å¾ˆä½ã€‚ 

åŒ…æ˜¯åŸºäºå†…ç½®æ¨¡å—å°è£…å‡ºæ¥çš„ï¼Œæä¾›äº†æ›´é«˜çº§ã€æ›´æ–¹ä¾¿çš„ APIï¼Œæå¤§çš„æé«˜äº†å¼€å‘æ•ˆç‡ã€‚ åŒ…å’Œå†…ç½®æ¨¡å—ä¹‹é—´çš„å…³ç³»ï¼Œç±»ä¼¼äº jQuery å’Œ æµè§ˆå™¨å†…ç½® API ä¹‹é—´çš„å…³ç³»ã€‚



åŸºæœ¬ç¤ºä¾‹ä»£ç ï¼š

```js
// å¯¼å…¥ momentåŒ…
// åœ¨å¯¼åŒ…å‰éœ€è¦å…ˆä¸‹è½½åŒ…
const moment = require('moment')

// è°ƒç”¨moment()æ–¹æ³•ï¼Œå¾—åˆ°å½“å‰æ—¶é—´
// é’ˆå¯¹å½“å‰çš„æ—¶é—´ï¼Œè°ƒç”¨format() æ–¹æ³•ï¼ŒæŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è¿›è¡Œæ—¶é—´çš„æ ¼å¼åŒ–
const dt = moment().format('YYYY-MM-DD HH:mm:ss')

console.log(dt);
```



å¦‚æœæƒ³åœ¨é¡¹ç›®ä¸­å®‰è£…æŒ‡å®šåç§°çš„åŒ…ï¼Œéœ€è¦è¿è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š

```js
npm i å®Œæ•´çš„åŒ…åç§°
```

åˆæ¬¡è£…åŒ…å®Œæˆåï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å¤šä¸€ä¸ªå«åš node_modules çš„æ–‡ä»¶å¤¹å’Œ package-lock.json çš„é…ç½®æ–‡ä»¶ã€‚



**å…¶ä¸­ï¼š** 

node_modules æ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾æ‰€æœ‰å·²å®‰è£…åˆ°é¡¹ç›®ä¸­çš„åŒ…ã€‚require() å¯¼å…¥ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œå°±æ˜¯ä»è¿™ä¸ªç›®å½•ä¸­æŸ¥æ‰¾å¹¶åŠ è½½åŒ…ã€‚ 

package-lock.json é…ç½®æ–‡ä»¶ç”¨æ¥è®°å½• node_modules ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªåŒ…çš„ä¸‹è½½ä¿¡æ¯ï¼Œä¾‹å¦‚åŒ…çš„åå­—ã€ç‰ˆæœ¬å·ã€ä¸‹è½½åœ°å€ç­‰ã€‚

> æ³¨æ„ï¼šç¨‹åºå‘˜ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ node_modules æˆ– package-lock.json æ–‡ä»¶ä¸­çš„ä»»ä½•ä»£ç ï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šè‡ªåŠ¨ç»´æŠ¤å®ƒä»¬ã€‚



**å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…**

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ npm install å‘½ä»¤å®‰è£…åŒ…çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„åŒ…ã€‚å¦‚æœéœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…ï¼Œå¯ä»¥åœ¨åŒ… åä¹‹åï¼Œé€šè¿‡ @ ç¬¦å·æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚:

```js
npm i moment@2.22.2
```



**åŒ…çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ**

åŒ…çš„ç‰ˆæœ¬å·æ˜¯ä»¥â€œç‚¹åˆ†åè¿›åˆ¶â€å½¢å¼è¿›è¡Œå®šä¹‰çš„ï¼Œæ€»å…±æœ‰ä¸‰ä½æ•°å­—ï¼Œä¾‹å¦‚ 2.24.0 å…¶ä¸­æ¯ä¸€ä½æ•°å­—æ‰€ä»£è¡¨çš„çš„å«ä¹‰å¦‚ä¸‹ï¼š 

ç¬¬1ä½æ•°å­—ï¼šå¤§ç‰ˆæœ¬ 

ç¬¬2ä½æ•°å­—ï¼šåŠŸèƒ½ç‰ˆæœ¬ 

ç¬¬3ä½æ•°å­—ï¼šBugä¿®å¤ç‰ˆæœ¬

> ç‰ˆæœ¬å·æå‡çš„è§„åˆ™ï¼šåªè¦å‰é¢çš„ç‰ˆæœ¬å·å¢é•¿äº†ï¼Œåˆ™åé¢çš„ç‰ˆæœ¬å·å½’é›¶ã€‚





**åŒ…ç®¡ç†é…ç½®æ–‡ä»¶**

npm è§„å®šï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªå«åš package.json çš„åŒ…ç®¡ç†é…ç½®æ–‡ä»¶ã€‚ç”¨æ¥è®°å½•ä¸é¡¹ç›®æœ‰å…³çš„ä¸€äº›é…ç½® ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

* é¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬å·ã€æè¿°ç­‰ 
* é¡¹ç›®ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›åŒ… 
* å“ªäº›åŒ…åªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ° 
* é‚£äº›åŒ…åœ¨å¼€å‘å’Œéƒ¨ç½²æ—¶éƒ½éœ€è¦ç”¨åˆ°



åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå«åš package.json çš„é…ç½®æ–‡ä»¶ï¼Œå³å¯ç”¨æ¥è®°å½•é¡¹ç›®ä¸­å®‰è£…äº†å“ªäº›åŒ…ã€‚ä»è€Œæ–¹ä¾¿å‰”é™¤ node_modules ç›®å½•ä¹‹åï¼Œåœ¨å›¢é˜Ÿæˆå‘˜ä¹‹é—´å…±äº«é¡¹ç›®çš„æºä»£ç ã€‚

> æ³¨æ„ï¼šä»Šååœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸€å®šè¦æŠŠ node_modules æ–‡ä»¶å¤¹ï¼Œæ·»åŠ åˆ° .gitignore å¿½ç•¥æ–‡ä»¶ä¸­ã€‚





**å¿«é€Ÿåˆ›å»º package.json**



npm åŒ…ç®¡ç†å·¥å…·æä¾›äº†ä¸€ä¸ªå¿«æ·å‘½ä»¤ï¼Œå¯ä»¥åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æ‰€å¤„çš„ç›®å½•ä¸­ï¼Œå¿«é€Ÿåˆ›å»º package.json è¿™ä¸ªåŒ…ç®¡ç† é…ç½®æ–‡ä»¶ï¼š

```js
// ä½œç”¨ï¼šåœ¨æ‰§è¡Œå‘½ä»¤æ‰€å¤„çš„ç›®å½•ä¸­ï¼Œå¿«é€Ÿæ–°å»ºpackage.jsonæ–‡ä»¶
npm init -y
```

**æ³¨æ„ï¼š**

> â‘  ä¸Šè¿°å‘½ä»¤åªèƒ½åœ¨è‹±æ–‡çš„ç›®å½•ä¸‹æˆåŠŸè¿è¡Œï¼æ‰€ä»¥ï¼Œé¡¹ç›®æ–‡ä»¶å¤¹çš„åç§°ä¸€å®šè¦ä½¿ç”¨è‹±æ–‡å‘½åï¼Œä¸è¦ä½¿ç”¨ä¸­æ–‡ï¼Œä¸èƒ½å‡ºç°ç©ºæ ¼ã€‚ 
>
> â‘¡ è¿è¡Œ npm install å‘½ä»¤å®‰è£…åŒ…çš„æ—¶å€™ï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šè‡ªåŠ¨æŠŠåŒ…çš„åç§°å’Œç‰ˆæœ¬å·ï¼Œè®°å½•åˆ° package.json ä¸­ã€‚





**dependencies èŠ‚ç‚¹**

package.json æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ª dependencies èŠ‚ç‚¹ï¼Œä¸“é—¨ç”¨æ¥è®°å½•æ‚¨ä½¿ç”¨ npm install  å‘½ä»¤å®‰è£…äº†å“ªäº›åŒ…ã€‚


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/e5eec838f67a46d9828065a749db8d7c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)




**ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰çš„åŒ…**

å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªå‰”é™¤äº† node_modules çš„é¡¹ç›®ä¹‹åï¼Œéœ€è¦å…ˆæŠŠæ‰€æœ‰çš„åŒ…ä¸‹è½½åˆ°é¡¹ç›®ä¸­ï¼Œæ‰èƒ½å°†é¡¹ç›®è¿è¡Œèµ·æ¥ã€‚ å¦åˆ™ä¼šæŠ¥ç±»ä¼¼äºä¸‹é¢çš„é”™è¯¯ï¼š

```js
// ç”±äºé¡¹ç›®è¿è¡Œä¾èµ–momentè¿™ä¸ªåŒ…ï¼Œå¦‚æœæ²¡æœ‰æå‰å®‰è£…å¥½è¿™ä¸ªåŒ…ï¼Œå°±ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯
Error: Cannot find module 'moment'
```



å¯ä»¥è¿è¡Œ npm install å‘½ä»¤ï¼ˆæˆ– npm iï¼‰ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰çš„ä¾èµ–åŒ…ï¼š

```js
// æ‰§è¡Œnpm install å‘½ä»¤æ—¶ï¼Œ npm åŒ…ç®¡ç†å·¥å…·ä¼šå…ˆè¯»å– package.jsonä¸­ dependenciesèŠ‚ç‚¹ï¼Œè¯»å–åˆ°è®°å½•çš„æ‰€æœ‰ä¾èµ–åŒ…åç§°å’Œç‰ˆæœ¬å·ä¹‹åï¼ŒnpmåŒ…ç®¡ç†å·¥å…·ä¼šæŠŠè¿™äº›åŒ…ä¸€æ¬¡æ€§ä¸‹è½½åˆ°é¡¹ç›®ä¸­
npm install 
```



**å¸è½½åŒ…**

å¯ä»¥è¿è¡Œ npm uninstall å‘½ä»¤ï¼Œæ¥å¸è½½æŒ‡å®šçš„åŒ…ï¼š

```js
// ä½¿ç”¨npm uninstall å…·ä½“çš„åŒ…å æ¥å¸è½½åŒ…
npm uninstall moment
```

> æ³¨æ„ï¼šnpm uninstall å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šæŠŠå¸è½½çš„åŒ…ï¼Œè‡ªåŠ¨ä» package.json çš„ dependencies ä¸­ç§»é™¤æ‰





**devDependencies èŠ‚ç‚¹**

å¦‚æœæŸäº›åŒ…åªåœ¨é¡¹ç›®å¼€å‘é˜¶æ®µä¼šç”¨åˆ°ï¼Œåœ¨é¡¹ç›®ä¸Šçº¿ä¹‹åä¸ä¼šç”¨åˆ°ï¼Œåˆ™å»ºè®®æŠŠè¿™äº›åŒ…è®°å½•åˆ° devDependencies èŠ‚ç‚¹ä¸­ã€‚ 

ä¸ä¹‹å¯¹åº”çš„ï¼Œå¦‚æœæŸäº›åŒ…åœ¨å¼€å‘å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½éœ€è¦ç”¨åˆ°ï¼Œåˆ™å»ºè®®æŠŠè¿™äº›åŒ…è®°å½•åˆ° dependencies èŠ‚ç‚¹ä¸­ã€‚



æ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼Œå°†åŒ…è®°å½•åˆ° devDependencies èŠ‚ç‚¹ä¸­ï¼š

```js
// å®‰è£…æŒ‡å®šçš„åŒ…ï¼Œå¹¶è®°å½•åˆ°devDenoendenciesèŠ‚ç‚¹ä¸­
npm i åŒ…å -D
// æ³¨æ„ï¼šä¸Šè¿°å‘½ä»¤æ—¶ç®€å†™å½¢å¼ï¼Œç­‰ä»·äºä¸‹é¢å®Œæ•´çš„å†™æ³•
npm install åŒ…å --save-dev
```



**åˆ‡æ¢ npm çš„ä¸‹åŒ…é•œåƒæº**

**nrm**

ä¸ºäº†æ›´æ–¹ä¾¿çš„åˆ‡æ¢ä¸‹åŒ…çš„é•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£… nrm è¿™ä¸ªå°å·¥å…·ï¼Œåˆ©ç”¨ nrm æä¾›çš„ç»ˆç«¯å‘½ä»¤ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹å’Œåˆ‡æ¢ä¸‹ åŒ…çš„é•œåƒæºã€‚

```js
// é€šè¿‡ npm åŒ…ç®¡ç†å™¨ï¼Œå°†nrmå®‰è£…ä¸ºå…¨å±€å¯ç”¨çš„å·¥å…·
npm i nrm -g
// æŸ¥çœ‹æ‰€æœ‰é•œåƒæº
nrm ls
// å°†ä¸‹åŒ…çš„é•œåƒåˆ‡æ¢ä¸ºtapbaoé•œåƒ
nrm use taobao
```





**åŒ…çš„åˆ†ç±»**

ä½¿ç”¨ npm åŒ…ç®¡ç†å·¥å…·ä¸‹è½½çš„åŒ…ï¼Œå…±åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š 

* é¡¹ç›®åŒ… 
* å…¨å±€åŒ…



**é¡¹ç›®åŒ…** é‚£äº›è¢«å®‰è£…åˆ°é¡¹ç›®çš„ node_modules ç›®å½•ä¸­çš„åŒ…ï¼Œéƒ½æ˜¯é¡¹ç›®åŒ…ã€‚

é¡¹ç›®åŒ…åˆåˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š 

* å¼€å‘ä¾èµ–åŒ…ï¼ˆè¢«è®°å½•åˆ° devDependencies èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ°ï¼‰ 
* æ ¸å¿ƒä¾èµ–åŒ…ï¼ˆè¢«è®°å½•åˆ° dependencies èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåœ¨å¼€å‘æœŸé—´å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½ä¼šç”¨åˆ°ï¼‰

```js
npm i åŒ…å -D # å¼€å‘ä¾èµ–åŒ…
npm i åŒ…å   # æ ¸å¿ƒä¾èµ–åŒ…
```



**å…¨å±€åŒ…**

åœ¨æ‰§è¡Œ npm install å‘½ä»¤æ—¶ï¼Œå¦‚æœæä¾›äº† -g å‚æ•°ï¼Œåˆ™ä¼šæŠŠåŒ…å®‰è£…ä¸ºå…¨å±€åŒ…ã€‚ å…¨å±€åŒ…ä¼šè¢«å®‰è£…åˆ° 

C:\Users\ç”¨æˆ·ç›®å½•\AppData\Roaming\npm\node_modules ç›®å½•ä¸‹ã€‚

```js
// å…¨å±€å®‰è£…æŒ‡å®šçš„åŒ…
npm i åŒ…å -g
// å¸è½½å…¨å±€å®‰è£…çš„åŒ…
npm uninstall åŒ…å -g
```

æ³¨æ„ï¼š 

> â‘  åªæœ‰å·¥å…·æ€§è´¨çš„åŒ…ï¼Œæ‰æœ‰å…¨å±€å®‰è£…çš„å¿…è¦æ€§ã€‚å› ä¸ºå®ƒä»¬æä¾›äº†å¥½ç”¨çš„ç»ˆç«¯å‘½ä»¤ã€‚ 
>
> â‘¡ åˆ¤æ–­æŸä¸ªåŒ…æ˜¯å¦éœ€è¦å…¨å±€å®‰è£…åæ‰èƒ½ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æä¾›çš„ä½¿ç”¨è¯´æ˜å³å¯ã€‚





**è§„èŒƒçš„åŒ…ç»“æ„**

åœ¨æ¸…æ¥šäº†åŒ…çš„æ¦‚å¿µã€ä»¥åŠå¦‚ä½•ä¸‹è½½å’Œä½¿ç”¨åŒ…ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹åŒ…çš„å†…éƒ¨ç»“æ„ã€‚

ä¸€ä¸ªè§„èŒƒçš„åŒ…ï¼Œå®ƒçš„ç»„æˆç»“æ„ï¼Œå¿…é¡»ç¬¦åˆä»¥ä¸‹ 3 ç‚¹è¦æ±‚ï¼š 

â‘  åŒ…å¿…é¡»ä»¥å•ç‹¬çš„ç›®å½•è€Œå­˜åœ¨ 

â‘¡ åŒ…çš„é¡¶çº§ç›®å½•ä¸‹è¦å¿…é¡»åŒ…å« package.json è¿™ä¸ªåŒ…ç®¡ç†é…ç½®æ–‡ä»¶ 

â‘¢ package.json ä¸­å¿…é¡»åŒ…å« nameï¼Œversionï¼Œmain è¿™ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä»£è¡¨åŒ…çš„åå­—ã€ç‰ˆæœ¬å·ã€åŒ…çš„å…¥å£ã€‚



### å¼€å‘å±äºè‡ªå·±çš„åŒ…

**åˆå§‹åŒ–åŒ…çš„åŸºæœ¬ç»“æ„**

â‘  æ–°å»º gaohan-tools æ–‡ä»¶å¤¹ï¼Œä½œä¸ºåŒ…çš„æ ¹ç›®å½• 

â‘¡ åœ¨ gaohan-tools æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»ºå¦‚ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š 

* package.json ï¼ˆåŒ…ç®¡ç†é…ç½®æ–‡ä»¶ï¼‰ 
* index.js ï¼ˆåŒ…çš„å…¥å£æ–‡ä»¶ï¼‰ 
* README.md ï¼ˆåŒ…çš„è¯´æ˜æ–‡æ¡£ï¼‰



**åˆå§‹åŒ– package.json**

```json
{
  "name": "gaohan-tools",
  "version": "1.1.0",
  "main": "index.js",
  "description": "æä¾›äº†æ ¼å¼åŒ–æ—¶é—´ã€HTMLEscapeç›¸å…³çš„åŠŸèƒ½",
  "keywords": [
    "itheima",
    "dateFormat",
    "escape"
  ],
  "license": "ISC"
}
```



**æ¨¡å—åŒ–æ‹†åˆ†**

â‘  å°†æ ¼å¼åŒ–æ—¶é—´çš„åŠŸèƒ½ï¼Œæ‹†åˆ†åˆ° src -> dateFormat.js ä¸­ 

â‘¡ å°†å¤„ç† HTML å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œæ‹†åˆ†åˆ° src -> htmlEscape.js ä¸­ 

â‘¢ åœ¨ index.js ä¸­ï¼Œå¯¼å…¥ä¸¤ä¸ªæ¨¡å—ï¼Œå¾—åˆ°éœ€è¦å‘å¤–å…±äº«çš„æ–¹æ³• 

â‘£ åœ¨ index.js ä¸­ï¼Œä½¿ç”¨ module.exports æŠŠå¯¹åº”çš„æ–¹æ³•å…±äº«å‡ºå»



**æ—¥æœŸæ ¼å¼åŒ–** dateFormat.js

```js
// å®šä¹‰æ ¼å¼åŒ–æ—¶é—´çš„å‡½æ•°
function dateFormat(dateStr) {
  const dt = new Date(dateStr)

  const y = dt.getFullYear()
  const m = padZero(dt.getMonth() + 1)
  const d = padZero(dt.getDate())

  const hh = padZero(dt.getHours())
  const mm = padZero(dt.getMinutes())
  const ss = padZero(dt.getSeconds())

  return `${y}-${m}-${d} ${hh}:${mm}:${ss}`
}

// å®šä¹‰ä¸€ä¸ªè¡¥é›¶çš„å‡½æ•°
function padZero(n) {
  return n > 9 ? n : '0' + n
}

module.exports = {
  dateFormat
}
```



**htmlæ ¼å¼åŒ–**  htmlEscape.js

```js
// å®šä¹‰è½¬ä¹‰ HTML å­—ç¬¦çš„å‡½æ•°
function htmlEscape(htmlstr) {
  return htmlstr.replace(/<|>|"|&/g, match => {
    switch (match) {
      case '<':
        return '&lt;'
      case '>':
        return '&gt;'
      case '"':
        return '&quot;'
      case '&':
        return '&amp;'
    }
  })
}

// å®šä¹‰è¿˜åŸ HTML å­—ç¬¦ä¸²çš„å‡½æ•°
function htmlUnEscape(str) {
  return str.replace(/&lt;|&gt;|&quot;|&amp;/g, match => {
    switch (match) {
      case '&lt;':
        return '<'
      case '&gt;':
        return '>'
      case '&quot;':
        return '"'
      case '&amp;':
        return '&'
    }
  })
}

module.exports = {
  htmlEscape,
  htmlUnEscape
}

```





**index.js æ˜¯åŒ…å…¥å£æ–‡ä»¶**

```js
// è¿™æ˜¯åŒ…çš„å…¥å£æ–‡ä»¶

const date = require('./src/dateFormat')
const escape = require('./src/htmlEscape')

// å‘å¤–æš´éœ²éœ€è¦çš„æˆå‘˜
module.exports = {
  ...date,
  ...escape
}
```





**ç¼–å†™åŒ…çš„è¯´æ˜æ–‡æ¡£**

åŒ…æ ¹ç›®å½•ä¸­çš„ README.md æ–‡ä»¶ï¼Œæ˜¯åŒ…çš„ä½¿ç”¨è¯´æ˜æ–‡æ¡£ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŠŠåŒ…çš„ä½¿ç”¨è¯´æ˜ï¼Œä»¥ markdown çš„ æ ¼å¼å†™å‡ºæ¥ï¼Œæ–¹ä¾¿ç”¨æˆ·å‚è€ƒã€‚ 

README æ–‡ä»¶ä¸­å…·ä½“å†™ä»€ä¹ˆå†…å®¹ï¼Œæ²¡æœ‰å¼ºåˆ¶æ€§çš„è¦æ±‚ï¼›åªè¦èƒ½å¤Ÿæ¸…æ™°åœ°æŠŠåŒ…çš„ä½œç”¨ã€ç”¨æ³•ã€æ³¨æ„äº‹é¡¹ç­‰æè¿°æ¸…æ¥šå³å¯ã€‚ 

æˆ‘ä»¬æ‰€åˆ›å»ºçš„è¿™ä¸ªåŒ…çš„ README.md æ–‡æ¡£ä¸­ï¼Œä¼šåŒ…å«ä»¥ä¸‹ 6 é¡¹å†…å®¹ï¼š 

å®‰è£…æ–¹å¼ã€å¯¼å…¥æ–¹å¼ã€æ ¼å¼åŒ–æ—¶é—´ã€è½¬ä¹‰ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€è¿˜åŸ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€å¼€æºåè®®



### å‘å¸ƒåŒ…

**æ³¨å†Œ npm è´¦å·**

â‘  è®¿é—® https://www.npmjs.com/ ç½‘ç«™ï¼Œç‚¹å‡» sign up æŒ‰é’®ï¼Œè¿›å…¥æ³¨å†Œç”¨æˆ·ç•Œé¢ 

â‘¡ å¡«å†™è´¦å·ç›¸å…³çš„ä¿¡æ¯ï¼šFull Nameã€Public Emailã€Usernameã€Password 

â‘¢ ç‚¹å‡» Create an Account æŒ‰é’®ï¼Œæ³¨å†Œè´¦å· 

â‘£ ç™»å½•é‚®ç®±ï¼Œç‚¹å‡»éªŒè¯é“¾æ¥ï¼Œè¿›è¡Œè´¦å·çš„éªŒè¯



**ç™»å½• npm è´¦å·**

npm è´¦å·æ³¨å†Œå®Œæˆåï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ npm login å‘½ä»¤ï¼Œä¾æ¬¡è¾“å…¥ç”¨æˆ·åã€å¯†ç ã€é‚®ç®±åï¼Œå³å¯ç™»å½•æˆåŠŸã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/39f183cc03454c189ff52271c13c93dc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGFuZ2FvMjMz,size_20,color_FFFFFF,t_70,g_se,x_16)


> æ³¨æ„ï¼šåœ¨è¿è¡Œ npm login å‘½ä»¤ä¹‹å‰ï¼Œå¿…é¡» å…ˆæŠŠä¸‹åŒ…çš„æœåŠ¡å™¨åœ°å€åˆ‡æ¢ä¸º npm çš„å®˜æ–¹ æœåŠ¡å™¨ã€‚å¦åˆ™ä¼šå¯¼è‡´å‘å¸ƒåŒ…å¤±è´¥ï¼





**æŠŠåŒ…å‘å¸ƒåˆ° npm ä¸Š**

å°†ç»ˆç«¯åˆ‡æ¢åˆ°åŒ…çš„æ ¹ç›®å½•ä¹‹åï¼Œè¿è¡Œ npm publish å‘½ä»¤ï¼Œå³å¯å°†åŒ…å‘å¸ƒåˆ° npm ä¸Šï¼ˆæ³¨æ„ï¼šåŒ…åä¸èƒ½é›·åŒï¼‰ã€‚





**åˆ é™¤å·²å‘å¸ƒçš„åŒ…**

è¿è¡Œ npm unpublish åŒ…å --force å‘½ä»¤ï¼Œå³å¯ä» npm åˆ é™¤å·²å‘å¸ƒçš„åŒ…ã€‚

**æ³¨æ„ï¼š** 

â‘  npm unpublish å‘½ä»¤åªèƒ½åˆ é™¤ 72 å°æ—¶ä»¥å†…å‘å¸ƒçš„åŒ… 

â‘¡ npm unpublish åˆ é™¤çš„åŒ…ï¼Œåœ¨ 24 å°æ—¶å†…ä¸å…è®¸é‡å¤å‘å¸ƒ 

â‘¢ å‘å¸ƒåŒ…çš„æ—¶å€™è¦æ…é‡ï¼Œå°½é‡ä¸è¦å¾€ npm ä¸Šå‘å¸ƒæ²¡æœ‰æ„ä¹‰çš„åŒ…ï¼





### æ¨¡å—çš„åŠ è½½æœºåˆ¶

**ä¼˜å…ˆä»ç¼“å­˜ä¸­åŠ è½½**

æ¨¡å—åœ¨ç¬¬ä¸€æ¬¡åŠ è½½åä¼šè¢«ç¼“å­˜ã€‚ è¿™ä¹Ÿæ„å‘³ç€å¤šæ¬¡è°ƒç”¨ require() ä¸ä¼šå¯¼è‡´æ¨¡å—çš„ä»£ç è¢«æ‰§è¡Œå¤šæ¬¡ã€‚

> æ³¨æ„ï¼šä¸è®ºæ˜¯å†…ç½®æ¨¡å—ã€ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—ã€è¿˜æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå®ƒä»¬éƒ½ä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­åŠ è½½ï¼Œä»è€Œæé«˜æ¨¡å—çš„åŠ è½½æ•ˆç‡ã€‚





**å†…ç½®æ¨¡å—çš„åŠ è½½æœºåˆ¶**

å†…ç½®æ¨¡å—æ˜¯ç”± Node.js å®˜æ–¹æä¾›çš„æ¨¡å—ï¼Œå†…ç½®æ¨¡å—çš„åŠ è½½ä¼˜å…ˆçº§æœ€é«˜ã€‚ 

ä¾‹å¦‚ï¼Œrequire('fs') å§‹ç»ˆè¿”å›å†…ç½®çš„ fs æ¨¡å—ï¼Œå³ä½¿åœ¨ node_modules ç›®å½•ä¸‹æœ‰åå­—ç›¸åŒçš„åŒ…ä¹Ÿå«åš fsã€‚





**è‡ªå®šä¹‰æ¨¡å—çš„åŠ è½½æœºåˆ¶**

ä½¿ç”¨ require() åŠ è½½è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¿…é¡»æŒ‡å®šä»¥ ./ æˆ– ../ å¼€å¤´çš„è·¯å¾„æ ‡è¯†ç¬¦ã€‚åœ¨åŠ è½½è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š ./ æˆ– ../  è¿™æ ·çš„è·¯å¾„æ ‡è¯†ç¬¦ï¼Œåˆ™ node ä¼šæŠŠå®ƒå½“ä½œå†…ç½®æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡ŒåŠ è½½ã€‚



åŒæ—¶ï¼Œåœ¨ä½¿ç”¨ require() å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¦‚æœçœç•¥äº†æ–‡ä»¶çš„æ‰©å±•åï¼Œåˆ™ Node.js ä¼šæŒ‰é¡ºåºåˆ†åˆ«å°è¯•åŠ è½½ä»¥ä¸‹çš„æ–‡ä»¶ï¼š 

â‘  æŒ‰ç…§ç¡®åˆ‡çš„æ–‡ä»¶åè¿›è¡ŒåŠ è½½ 

â‘¡ è¡¥å…¨ .js æ‰©å±•åè¿›è¡ŒåŠ è½½ 

â‘¢ è¡¥å…¨ .json æ‰©å±•åè¿›è¡ŒåŠ è½½ 

â‘£ è¡¥å…¨ .node æ‰©å±•åè¿›è¡ŒåŠ è½½ 

â‘¤ åŠ è½½å¤±è´¥ï¼Œç»ˆç«¯æŠ¥é”™





**ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠ è½½æœºåˆ¶**

å¦‚æœä¼ é€’ç»™ require() çš„æ¨¡å—æ ‡è¯†ç¬¦ä¸æ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œä¹Ÿæ²¡æœ‰ä»¥ â€˜./â€™ æˆ– â€˜../â€™ å¼€å¤´ï¼Œåˆ™ Node.js ä¼šä»å½“å‰æ¨¡å—çš„çˆ¶ ç›®å½•å¼€å§‹ï¼Œå°è¯•ä» /node_modules æ–‡ä»¶å¤¹ä¸­åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚

å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œåˆ™ç§»åŠ¨åˆ°å†ä¸Šä¸€å±‚çˆ¶ç›®å½•ä¸­ï¼Œè¿›è¡ŒåŠ è½½ï¼Œç›´åˆ°æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾åœ¨ 'C:\Users\itheima\project\foo.js' æ–‡ä»¶é‡Œè°ƒç”¨äº† require('tools')ï¼Œåˆ™ Node.js ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ï¼š

â‘  C:\Users\itheima\project\node_modules\tools 

â‘¡ C:\Users\itheima\node_modules\tools 

â‘¢ C:\Users\node_modules\tools 

â‘£ C:\node_modules\tools





æ—¢ç„¶å­˜åœ¨äº†`AMD`ä»¥åŠ`CommonJs`æœºåˆ¶ï¼Œ`ES6`çš„`Module`åˆæœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ

ES6 åœ¨è¯­è¨€æ ‡å‡†çš„å±‚é¢ä¸Šï¼Œå®ç°äº†`Module`ï¼Œå³æ¨¡å—åŠŸèƒ½ï¼Œå®Œå…¨å¯ä»¥å–ä»£ `CommonJS`å’Œ `AMD`è§„èŒƒï¼Œæˆä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šç”¨çš„æ¨¡å—è§£å†³æ–¹æ¡ˆ

`CommonJS` å’Œ`AMD` æ¨¡å—ï¼Œéƒ½åªèƒ½åœ¨è¿è¡Œæ—¶ç¡®å®šè¿™äº›ä¸œè¥¿ã€‚æ¯”å¦‚ï¼Œ`CommonJS`æ¨¡å—å°±æ˜¯å¯¹è±¡ï¼Œè¾“å…¥æ—¶å¿…é¡»æŸ¥æ‰¾å¯¹è±¡å±æ€§

```javascript
// CommonJSæ¨¡å—
let { stat, exists, readfile } = require('fs');

// ç­‰åŒäº
let _fs = require('fs');
let stat = _fs.stat;
let exists = _fs.exists;
let readfile = _fs.readfile;
```

`ES6`è®¾è®¡æ€æƒ³æ˜¯å°½é‡çš„é™æ€åŒ–ï¼Œä½¿å¾—ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè¾“å…¥å’Œè¾“å‡ºçš„å˜é‡

```js
// ES6æ¨¡å—
import { stat, exists, readFile } from 'fs';
```

ä¸Šè¿°ä»£ç ï¼ŒåªåŠ è½½3ä¸ªæ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ä¸åŠ è½½ï¼Œå³ `ES6` å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆæ¨¡å—åŠ è½½

ç”±äºç¼–è¯‘åŠ è½½ï¼Œä½¿å¾—é™æ€åˆ†ææˆä¸ºå¯èƒ½ã€‚åŒ…æ‹¬ç°åœ¨æµè¡Œçš„`typeScript`ä¹Ÿæ˜¯ä¾é é™æ€åˆ†æå®ç°åŠŸèƒ½





## ES6 Moudle

`ES6`æ¨¡å—å†…éƒ¨è‡ªåŠ¨é‡‡ç”¨äº†ä¸¥æ ¼æ¨¡å¼ï¼Œè¿™é‡Œå°±ä¸å±•å¼€ä¸¥æ ¼æ¨¡å¼çš„é™åˆ¶ï¼Œæ¯•ç«Ÿè¿™æ˜¯`ES5`ä¹‹å‰å°±å·²ç»è§„å®šå¥½

æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±ä¸¤ä¸ªå‘½ä»¤æ„æˆï¼š

- `export`ï¼šç”¨äºè§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£
- `import`ï¼šç”¨äºè¾“å…¥å…¶ä»–æ¨¡å—æä¾›çš„åŠŸèƒ½

### export

#### åˆ†åˆ«æš´éœ²

```js
// åˆ†åˆ«æš´éœ²æ¨¡å—
export function foo() {
    console.log('foo()');
}

export function bar() {
    console.log('bar()');
}

export let arr = [1, 2, 3, 4, 5]
```

#### ç»Ÿä¸€æš´éœ²

```js
// ç»Ÿä¸€æš´éœ²
function fun() {
    console.log('fun()');
}

function fun2() {
    console.log('fun2()');
}

export { fun, fun2 }
```

#### **é»˜è®¤æš´éœ²**

```js
// é»˜è®¤æš´éœ²
export default {
    msg: 'hello......',
    fun: () => {
        console.log('aaaaaaaaaaaaa');
    }
}
```

### import

#### **å¼•å…¥æ¨¡å—**

```js
// å¼•å…¥å…¶ä»–çš„æ¨¡å—
// å¦‚æœæ˜¯å•ä¸ªçš„jsæ–‡ä»¶ å¼•å…¥æ—¶è¦åŠ ä¸Šåç¼€
// å¼•å…¥çš„æ˜¯ä¸€ä¸ªnpmä¸‹è½½çš„åŒ…ï¼Œå°±ä¸éœ€è¦åŠ åç¼€
import {foo, bar} from './module1.js'
import {fun, fun2} from './module2.js'
import module3 from './module3.js'
import $ from 'jquery'
import express from 'express'

foo();
bar();
fun();
fun2();
console.log(module3.msg);;
console.log(module3.fun());
```

#### æ¨¡å—ä½œç”¨åŸŸ

æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„é¡¶çº§ä½œç”¨åŸŸï¼ˆtop-level scopeï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªæ¨¡å—ä¸­çš„é¡¶çº§ä½œç”¨åŸŸå˜é‡å’Œå‡½æ•°åœ¨å…¶ä»–è„šæœ¬ä¸­æ˜¯ä¸å¯è§çš„ã€‚

#### æ¨¡å—ä»£ç ä»…åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶è¢«è§£æ

å¦‚æœåŒä¸€ä¸ªæ¨¡å—è¢«å¯¼å…¥åˆ°å¤šä¸ªå…¶ä»–ä½ç½®ï¼Œé‚£ä¹ˆå®ƒçš„ä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³åœ¨ç¬¬ä¸€æ¬¡è¢«å¯¼å…¥æ—¶ã€‚


#### åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œâ€œthisâ€ æ˜¯ undefined

è¿™æ˜¯ä¸€ä¸ªå°åŠŸèƒ½ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§ï¼Œæˆ‘ä»¬åº”è¯¥æåˆ°å®ƒã€‚

åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œé¡¶çº§ this æ˜¯ undefinedã€‚

å°†å…¶ä¸éæ¨¡å—è„šæœ¬è¿›è¡Œæ¯”è¾ƒä¼šå‘ç°ï¼Œéæ¨¡å—è„šæœ¬çš„é¡¶çº§ this æ˜¯å…¨å±€å¯¹è±¡ï¼š

```js
<script>
  alert(this); // window
</script>

<script type="module">
  alert(this); // undefined
</script>
```

#### Import *

é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠè¦å¯¼å…¥çš„ä¸œè¥¿åˆ—åœ¨èŠ±æ‹¬å· import {...} ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š

```js
// ğŸ“ main.js
import {sayHi, sayBye} from './say.js';

sayHi('John'); // Hello, John!
sayBye('John'); // Bye, John!
```

ä½†æ˜¯å¦‚æœæœ‰å¾ˆå¤šè¦å¯¼å…¥çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ import * as <obj> å°†æ‰€æœ‰å†…å®¹å¯¼å…¥ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ï¼š

```js
// ğŸ“ main.js
import * as say from './say.js';

say.sayHi('John');
say.sayBye('John');
```

ä¹ä¸€çœ‹ï¼Œâ€œé€šé€šå¯¼å…¥â€çœ‹èµ·æ¥å¾ˆé…·ï¼Œå†™èµ·æ¥ä¹Ÿå¾ˆçŸ­ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¸ºä»€ä¹ˆè¦æ˜ç¡®åˆ—å‡ºæˆ‘ä»¬éœ€è¦å¯¼å…¥çš„å†…å®¹ï¼Ÿ

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‘æˆ‘ä»¬çš„é¡¹ç›®é‡Œæ·»åŠ ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ say.jsï¼Œå®ƒå…·æœ‰è®¸å¤šå‡½æ•°ï¼š
è¿™é‡Œæœ‰å‡ ä¸ªåŸå› ã€‚

* ç°ä»£çš„æ„å»ºå·¥å…·ï¼ˆwebpack å’Œå…¶ä»–å·¥å…·ï¼‰å°†æ¨¡å—æ‰“åŒ…åˆ°ä¸€èµ·å¹¶å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠ å¿«åŠ è½½é€Ÿåº¦å¹¶åˆ é™¤æœªä½¿ç”¨çš„ä»£ç ã€‚
  æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‘æˆ‘ä»¬çš„é¡¹ç›®é‡Œæ·»åŠ ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ say.jsï¼Œå®ƒå…·æœ‰è®¸å¤šå‡½æ•°ï¼š

  ```js
  // ğŸ“ say.js
  export function sayHi() { ... }
  export function sayBye() { ... }
  export function becomeSilent() { ... }
  ```

  ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åªåœ¨æˆ‘ä»¬çš„é¡¹ç›®é‡Œä½¿ç”¨äº† say.js ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼š


  ```js
  // ğŸ“ main.js
  import {sayHi} from './say.js';
  ```

  é‚£ä¹ˆï¼Œä¼˜åŒ–å™¨ï¼ˆoptimizerï¼‰å°±ä¼šæ£€æµ‹åˆ°å®ƒï¼Œå¹¶ä»æ‰“åŒ…å¥½çš„ä»£ç ä¸­åˆ é™¤é‚£äº›æœªè¢«ä½¿ç”¨çš„å‡½æ•°ï¼Œä»è€Œä½¿æ„å»ºæ›´å°ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œæ‘‡æ ‘ï¼ˆtree-shakingï¼‰â€ã€‚

* æ˜ç¡®åˆ—å‡ºè¦å¯¼å…¥çš„å†…å®¹ä¼šä½¿å¾—åç§°è¾ƒçŸ­ï¼šsayHi() è€Œä¸æ˜¯ say.sayHi()ã€‚

* å¯¼å…¥çš„æ˜¾å¼åˆ—è¡¨å¯ä»¥æ›´å¥½åœ°æ¦‚è¿°ä»£ç ç»“æ„ï¼šä½¿ç”¨çš„å†…å®¹å’Œä½ç½®ã€‚å®ƒä½¿å¾—ä»£ç æ”¯æŒé‡æ„ï¼Œå¹¶ä¸”é‡æ„èµ·æ¥æ›´å®¹æ˜“ã€‚

> ä¸ç”¨èŠ±æ‹¬å·çš„å¯¼å…¥çœ‹èµ·æ¥å¾ˆé…·ã€‚åˆšå¼€å§‹ä½¿ç”¨æ¨¡å—æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„é”™è¯¯å°±æ˜¯å¿˜è®°å†™èŠ±æ‹¬å·ã€‚æ‰€ä»¥ï¼Œè¯·è®°ä½ï¼Œimport å‘½åçš„å¯¼å‡ºæ—¶éœ€è¦èŠ±æ‹¬å·ï¼Œè€Œ import é»˜è®¤çš„å¯¼å‡ºæ—¶ä¸éœ€è¦èŠ±æ‹¬å·ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/f5375fa15b484912ae514b64eb232618.png)



## ä½¿ç”¨åœºæ™¯

å¦‚ä»Šï¼Œ`ES6`æ¨¡å—åŒ–å·²ç»æ·±å…¥æˆ‘ä»¬æ—¥å¸¸é¡¹ç›®å¼€å‘ä¸­ï¼Œåƒ`vue`ã€`react`é¡¹ç›®æ­å»ºé¡¹ç›®ï¼Œç»„ä»¶åŒ–å¼€å‘å¤„å¤„å¯è§ï¼Œå…¶ä¹Ÿæ˜¯ä¾èµ–æ¨¡å—åŒ–å®ç°

`vue`ç»„ä»¶

```js
<template>
  <div class="App">
      ç»„ä»¶åŒ–å¼€å‘ ---- æ¨¡å—åŒ–
  </div>
</template>

<script>
export default {
  name: 'HelloWorld',
  props: {
    msg: String
  }
}
</script>
```

`react`ç»„ä»¶

```js
function App() {
  return (
    <div className="App">
		ç»„ä»¶åŒ–å¼€å‘ ---- æ¨¡å—åŒ–
    </div>
  );
}

export default App;
```

åŒ…æ‹¬å®Œæˆä¸€äº›å¤æ‚åº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹†åˆ†æˆå„ä¸ªæ¨¡å—





# 8. ä½ æ˜¯æ€ä¹ˆç†è§£ES6ä¸­ Decorator çš„ï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ

![img](https://static.vue-js.com/7df43560-5ba5-11eb-85f6-6fac77c0c9b3.png)

## ä¸€ã€ä»‹ç»

Decoratorï¼Œå³è£…é¥°å™¨ï¼Œä»åå­—ä¸Šå¾ˆå®¹æ˜“è®©æˆ‘ä»¬è”æƒ³åˆ°è£…é¥°è€…æ¨¡å¼

ç®€å•æ¥è®²ï¼Œè£…é¥°è€…æ¨¡å¼å°±æ˜¯ä¸€ç§åœ¨ä¸æ”¹å˜åŸç±»å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•å¯¹è±¡åŠŸèƒ½çš„è®¾è®¡ç†è®ºã€‚

`ES6`ä¸­`Decorator`åŠŸèƒ½äº¦å¦‚æ­¤ï¼Œå…¶æœ¬è´¨ä¹Ÿä¸æ˜¯ä»€ä¹ˆé«˜å¤§ä¸Šçš„ç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œç”¨äºæ‰©å±•ç±»å±æ€§å’Œç±»æ–¹æ³•

è¿™é‡Œå®šä¹‰ä¸€ä¸ªå£«å…µï¼Œè¿™æ—¶å€™ä»–ä»€ä¹ˆè£…å¤‡éƒ½æ²¡æœ‰

```js
class soldier{ 
}
```

å®šä¹‰ä¸€ä¸ªå¾—åˆ° AK è£…å¤‡çš„å‡½æ•°ï¼Œå³è£…é¥°å™¨

```js
function strong(target){
    target.AK = true
}
```

ä½¿ç”¨è¯¥è£…é¥°å™¨å¯¹å£«å…µè¿›è¡Œå¢å¼º

```js
@strong
class soldier{
}
```

è¿™æ—¶å€™å£«å…µå°±æœ‰æ­¦å™¨äº†

```js
soldier.AK // true
```

ä¸Šè¿°ä»£ç è™½ç„¶ç®€å•ï¼Œä½†ä¹Ÿèƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°äº†ä½¿ç”¨`Decorator`ä¸¤å¤§ä¼˜ç‚¹ï¼š

- ä»£ç å¯è¯»æ€§å˜å¼ºäº†ï¼Œè£…é¥°å™¨å‘½åç›¸å½“äºä¸€ä¸ªæ³¨é‡Š
- åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç æƒ…å†µä¸‹ï¼Œå¯¹åŸæ¥åŠŸèƒ½è¿›è¡Œæ‰©å±•

## äºŒã€ç”¨æ³•

`Docorator`ä¿®é¥°å¯¹è±¡ä¸ºä¸‹é¢ä¸¤ç§ï¼š

- ç±»çš„è£…é¥°
- ç±»å±æ€§çš„è£…é¥°

### ç±»çš„è£…é¥°

å½“å¯¹ç±»æœ¬èº«è¿›è¡Œè£…é¥°çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³ç±»æœ¬èº«

å°†è£…é¥°å™¨è¡Œä¸ºè¿›è¡Œåˆ†è§£ï¼Œå¤§å®¶èƒ½å¤Ÿæœ‰ä¸ªæ›´æ·±å…¥çš„äº†è§£

```js
@decorator
class A {}

// ç­‰åŒäº

class A {}
A = decorator(A) || A;
```

ä¸‹é¢`@testable`å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œ`target`å°±æ˜¯ä¼ å…¥çš„ç±»ï¼Œå³`MyTestableClass`ï¼Œå®ç°äº†ä¸ºç±»æ·»åŠ é™æ€å±æ€§

```js
@testable
class MyTestableClass {
  // ...
}

function testable(target) {
  target.isTestable = true;
}

MyTestableClass.isTestable // true
```

å¦‚æœæƒ³è¦ä¼ é€’å‚æ•°ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–å±‚å†å°è£…ä¸€å±‚å‡½æ•°

```js
function testable(isTestable) {
  return function(target) {
    target.isTestable = isTestable;
  }
}

@testable(true)
class MyTestableClass {}
MyTestableClass.isTestable // true

@testable(false)
class MyClass {}
MyClass.isTestable // false
```

### ç±»å±æ€§çš„è£…é¥°

å½“å¯¹ç±»å±æ€§è¿›è¡Œè£…é¥°çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- ç±»çš„åŸå‹å¯¹è±¡
- éœ€è¦è£…é¥°çš„å±æ€§å
- è£…é¥°å±æ€§åçš„æè¿°å¯¹è±¡

é¦–å…ˆå®šä¹‰ä¸€ä¸ª`readonly`è£…é¥°å™¨

```js
function readonly(target, name, descriptor){
  descriptor.writable = false; // å°†å¯å†™å±æ€§è®¾ä¸ºfalse
  return descriptor;
}
```

ä½¿ç”¨`readonly`è£…é¥°ç±»çš„`name`æ–¹æ³•

```javascript
class Person {
  @readonly
  name() { return `${this.first} ${this.last}` }
}
```

ç›¸å½“äºä»¥ä¸‹è°ƒç”¨

```js
readonly(Person.prototype, 'name', descriptor);
```

å¦‚æœä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œå°±åƒæ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œå†ç”±å†…åˆ°å¤–æ‰§è¡Œ

```javascript
function dec(id){
    console.log('evaluated', id);
    return (target, property, descriptor) =>console.log('executed', id);
}

class Example {
    @dec(1)
    @dec(2)
    method(){}
}
// evaluated 1
// evaluated 2
// executed 2
// executed 1
```

å¤–å±‚è£…é¥°å™¨`@dec(1)`å…ˆè¿›å…¥ï¼Œä½†æ˜¯å†…å±‚è£…é¥°å™¨`@dec(2)`å…ˆæ‰§è¡Œ

### æ³¨æ„

è£…é¥°å™¨ä¸èƒ½ç”¨äºä¿®é¥°å‡½æ•°ï¼Œå› ä¸ºå‡½æ•°å­˜åœ¨å˜é‡å£°æ˜æƒ…å†µ

```js
var counter = 0;

var add = function () {
  counter++;
};

@add
function foo() {
}
```

ç¼–è¯‘é˜¶æ®µï¼Œå˜æˆä¸‹é¢

```js
var counter;
var add;

@add
function foo() {
}

counter = 0;

add = function () {
  counter++;
};
```

æ„å›¾æ˜¯æ‰§è¡Œå`counter`ç­‰äº 1ï¼Œä½†æ˜¯å®é™…ä¸Šç»“æœæ˜¯`counter`ç­‰äº 0

## ä¸‰ã€ä½¿ç”¨åœºæ™¯

åŸºäº`Decorator`å¼ºå¤§çš„ä½œç”¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå®Œæˆå„ç§åœºæ™¯çš„éœ€æ±‚ï¼Œä¸‹é¢ç®€å•åˆ—ä¸¾å‡ ç§ï¼š

ä½¿ç”¨`react-redux`çš„æ—¶å€™ï¼Œå¦‚æœå†™æˆä¸‹é¢è¿™ç§å½¢å¼ï¼Œæ—¢ä¸é›…è§‚ä¹Ÿå¾ˆéº»çƒ¦

```js
class MyReactComponent extends React.Component {}

export default connect(mapStateToProps, mapDispatchToProps)(MyReactComponent);
```

é€šè¿‡è£…é¥°å™¨å°±å˜å¾—ç®€æ´å¤šäº†

```js
@connect(mapStateToProps, mapDispatchToProps)
export default class MyReactComponent extends React.Component {}
```

å°†`mixins`ï¼Œä¹Ÿå¯ä»¥å†™æˆè£…é¥°å™¨ï¼Œè®©ä½¿ç”¨æ›´ä¸ºç®€æ´äº†

```js
function mixins(...list) {
  return function (target) {
    Object.assign(target.prototype, ...list);
  };
}

// ä½¿ç”¨
const Foo = {
  foo() { console.log('foo') }
};

@mixins(Foo)
class MyClass {}

let obj = new MyClass();
obj.foo() // "foo"
```

ä¸‹é¢å†è®²è®²`core-decorators.js`å‡ ä¸ªå¸¸è§çš„è£…é¥°å™¨

### @antobind

`autobind`è£…é¥°å™¨ä½¿å¾—æ–¹æ³•ä¸­çš„`this`å¯¹è±¡ï¼Œç»‘å®šåŸå§‹å¯¹è±¡

```javascript
import { autobind } from 'core-decorators';

class Person {
  @autobind
  getPerson() {
    return this;
  }
}

let person = new Person();
let getPerson = person.getPerson;

getPerson() === person;
// true
```

### @readonly

`readonly`è£…é¥°å™¨ä½¿å¾—å±æ€§æˆ–æ–¹æ³•ä¸å¯å†™

```javascript
import { readonly } from 'core-decorators';

class Meal {
  @readonly
  entree = 'steak';
}

var dinner = new Meal();
dinner.entree = 'salmon';
// Cannot assign to read only property 'entree' of [object Object]
```

### @deprecate

`deprecate`æˆ–`deprecated`è£…é¥°å™¨åœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸€æ¡è­¦å‘Šï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å°†åºŸé™¤

```javascript
import { deprecate } from 'core-decorators';

class Person {
  @deprecate
  facepalm() {}

  @deprecate('åŠŸèƒ½åºŸé™¤äº†')
  facepalmHard() {}
}

let person = new Person();

person.facepalm();
// DEPRECATION Person#facepalm: This function will be removed in future versions.

person.facepalmHard();
// DEPRECATION Person#facepalmHard: åŠŸèƒ½åºŸé™¤äº†
```







# 9. let,var,const çš„åŒºåˆ«

**ï¼ˆ1ï¼‰å—çº§ä½œç”¨åŸŸï¼š** å—ä½œç”¨åŸŸç”± `{ }`åŒ…æ‹¬ï¼Œletå’Œconstå…·æœ‰å—çº§ä½œç”¨åŸŸï¼Œvarä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸã€‚å—çº§ä½œç”¨åŸŸè§£å†³äº†ES5ä¸­çš„ä¸¤ä¸ªé—®é¢˜ï¼š

- å†…å±‚å˜é‡å¯èƒ½è¦†ç›–å¤–å±‚å˜é‡
- ç”¨æ¥è®¡æ•°çš„å¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡

**ï¼ˆ2ï¼‰å˜é‡æå‡ï¼š** varå­˜åœ¨å˜é‡æå‡ï¼Œletå’Œconstä¸å­˜åœ¨å˜é‡æå‡ï¼Œå³åœ¨å˜é‡åªèƒ½åœ¨å£°æ˜ä¹‹åä½¿ç”¨ï¼Œå¦åœ¨ä¼šæŠ¥é”™ã€‚

**ï¼ˆ3ï¼‰ç»™å…¨å±€æ·»åŠ å±æ€§ï¼š** æµè§ˆå™¨çš„å…¨å±€å¯¹è±¡æ˜¯windowï¼ŒNodeçš„å…¨å±€å¯¹è±¡æ˜¯globalã€‚varå£°æ˜çš„å˜é‡ä¸ºå…¨å±€å˜é‡ï¼Œå¹¶ä¸”ä¼šå°†è¯¥å˜é‡æ·»åŠ ä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œä½†æ˜¯letå’Œconstä¸ä¼šã€‚

**ï¼ˆ4ï¼‰é‡å¤å£°æ˜ï¼š** varå£°æ˜å˜é‡æ—¶ï¼Œå¯ä»¥é‡å¤å£°æ˜å˜é‡ï¼Œåå£°æ˜çš„åŒåå˜é‡ä¼šè¦†ç›–ä¹‹å‰å£°æ˜çš„éå†ã€‚constå’Œletä¸å…è®¸é‡å¤å£°æ˜å˜é‡ã€‚

**ï¼ˆ5ï¼‰æš‚æ—¶æ€§æ­»åŒºï¼š** åœ¨ä½¿ç”¨letã€constå‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸º**æš‚æ—¶æ€§æ­»åŒº**ã€‚ä½¿ç”¨varå£°æ˜çš„å˜é‡ä¸å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºã€‚

**ï¼ˆ6ï¼‰åˆå§‹å€¼è®¾ç½®ï¼š** åœ¨å˜é‡å£°æ˜æ—¶ï¼Œvar å’Œ let å¯ä»¥ä¸ç”¨è®¾ç½®åˆå§‹å€¼ã€‚è€Œconstå£°æ˜å˜é‡å¿…é¡»è®¾ç½®åˆå§‹å€¼ã€‚

**ï¼ˆ7ï¼‰æŒ‡é’ˆæŒ‡å‘ï¼š** letå’Œconstéƒ½æ˜¯ES6æ–°å¢çš„ç”¨äºåˆ›å»ºå˜é‡çš„è¯­æ³•ã€‚ letåˆ›å»ºçš„å˜é‡æ˜¯å¯ä»¥æ›´æ”¹æŒ‡é’ˆæŒ‡å‘ï¼ˆå¯ä»¥é‡æ–°èµ‹å€¼ï¼‰ã€‚ä½†constå£°æ˜çš„å˜é‡æ˜¯ä¸å…è®¸æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ã€‚

